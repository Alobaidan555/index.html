<!doctype html>
<html lang="ar" dir="rtl">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø§Øª Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠ</title>
  
  <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-firestore.js"></script>
  
  <script>
      // ğŸŸ¢ Ù‚ÙŠÙ… FirebaseConfig Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ© Ø§Ù„ØªÙŠ Ø£Ø±Ø³Ù„Ù‡Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
      const firebaseConfig = {
          apiKey: "AIzaSyBJbUi4uSOwaBev2HpbTH0DOtaeqSGiUxg",
          authDomain: "project-2o25.firebaseapp.com",
          projectId: "project-2o25",
          // Ø§Ø³ØªØ®Ø¯Ø§Ù… storageBucket Ùˆ messagingSenderId ØºÙŠØ± Ø¶Ø±ÙˆØ±ÙŠ Ù‡Ù†Ø§ Ù„ÙƒÙ† Ù†ØªØ±ÙƒÙ‡Ù…Ø§ ÙƒÙ…Ø¹Ù„ÙˆÙ…Ø§Øª
          storageBucket: "project-2o25.firebasestorage.app",
          messagingSenderId: "995772420566",
          appId: "1:995772420566:web:44b5b6059f1f86ab499477"
      };

      // ØªÙ‡ÙŠØ¦Ø© Firebase Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Version 8
      firebase.initializeApp(firebaseConfig);
      const db = firebase.firestore();
      
      // ØªØ¹Ø±ÙŠÙ Ø«Ø§Ø¨Øª Ù„Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ø³Ø¬Ù„Ø§Øª
      const COLLECTION_NAME = 'competition_data'; 
  </script>
  
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
  <style>
        body {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100%;
            display: flex;
            flex-direction: column;
        }
        
        * {
            box-sizing: border-box;
        }
        
        .container {
            flex: 1;
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
            padding: 30px 20px;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin: 0 0 10px 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        .main-card {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            margin-bottom: 20px;
        }
        
        .entity-selector {
            margin-bottom: 30px;
        }
        
        .entity-selector label {
            display: block;
            font-size: 1.1em;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }
        
        .entity-selector select {
            width: 100%;
            padding: 15px;
            font-size: 1em;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .entity-selector select:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .quick-access {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .access-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .access-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }
        
        .access-card h3 {
            margin: 0 0 10px 0;
            font-size: 1.5em;
        }
        
        .access-card p {
            margin: 0;
            opacity: 0.9;
        }
        
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.1em;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
            width: 100%;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .btn-secondary {
            background: #6c757d;
        }
        
        .btn-danger {
            background: #dc3545;
        }
        
        .btn-success {
            background: #28a745;
        }
        
        .section-title {
            font-size: 2em;
            color: #333;
            margin: 0 0 20px 0;
            text-align: center;
        }
        
        .login-form {
            max-width: 400px;
            margin: 0 auto;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            font-weight: bold;
            color: #333;
            margin-bottom: 8px;
        }
        
        .form-group input, .form-group textarea, .form-group select {
            width: 100%;
            padding: 12px;
            font-size: 1em;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            transition: all 0.3s;
        }
        
        .form-group input:focus, .form-group textarea:focus, .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .entity-sections {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .section-card {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 40px;
            border-radius: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .section-card:hover {
            transform: scale(1.05);
        }
        
        .section-card h3 {
            font-size: 1.8em;
            margin: 0;
        }
        
        .quiz-list {
            display: grid;
            gap: 15px;
        }
        
        .quiz-item {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border-right: 5px solid #667eea;
        }
        
        .quiz-item h4 {
            margin: 0 0 10px 0;
            color: #333;
        }
        
        .quiz-item-meta {
            display: flex;
            gap: 15px;
            font-size: 0.9em;
            color: #666;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }
        
        .leaderboard-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .leaderboard-table th {
            background: #667eea;
            color: white;
            padding: 15px;
            text-align: right;
        }
        
        .leaderboard-table td {
            padding: 15px;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .leaderboard-table tr:nth-child(even) {
            background: #f8f9fa;
        }
        
        /* ğŸ†• Ø£Ù†Ù…Ø§Ø· Ø¹Ø¬Ù„Ø© Ø§Ù„Ø­Ø¸ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© */
        .wheel-container-new {
            position: relative;
            width: min(400px, 90vw);
            height: min(400px, 90vw);
            max-width: 500px;
            max-height: 500px;
        }
        .arrow-new {
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: clamp(15px, 2vw, 20px) solid transparent;
            border-right: clamp(15px, 2vw, 20px) solid transparent;
            border-top: clamp(30px, 4vw, 40px) solid #e57373;
            z-index: 10;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
        }
        .center-circle-new {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: clamp(40px, 8vw, 60px);
            height: clamp(40px, 8vw, 60px);
            background: #ffffff;
            border-radius: 50%;
            border: 4px solid #64b5f6;
            z-index: 5;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }
        /* Ù†Ù‡Ø§ÙŠØ© Ø£Ù†Ù…Ø§Ø· Ø¹Ø¬Ù„Ø© Ø§Ù„Ø­Ø¸ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© */

        .winner-display {
            text-align: center;
            font-size: 2em;
            font-weight: bold;
            color: #28a745;
            margin: 20px 0;
            padding: 20px;
            background: #d4edda;
            border-radius: 10px;
        }
        
        .member-list {
            margin-top: 20px;
        }
        
        .member-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .toast {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #28a745;
            color: white;
            padding: 15px 30px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            z-index: 1000;
            display: none;
        }
        
        .toast.error {
            background: #dc3545;
        }
        
        .toast.show {
            display: block;
            animation: slideDown 0.3s ease;
        }
        
        @keyframes slideDown {
            from {
                transform: translateX(-50%) translateY(-100%);
            }
            to {
                transform: translateX(-50%) translateY(0);
            }
        }
        
        .back-btn {
            background: #6c757d;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            margin-bottom: 20px;
        }
        
        .back-btn:hover {
            background: #5a6268;
        }
        
        .hidden {
            display: none;
        }
        
        .question-item {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .answer-option {
            display: block;
            padding: 10px;
            margin: 5px 0;
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .answer-option:hover {
            border-color: #667eea;
        }
        
        .answer-option input {
            margin-left: 10px;
        }
        
        .question-form {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 2px solid #e0e0e0;
        }
        
        .question-form-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .remove-question-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 5px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
        }
        
        .copy-question-btn {
            background: #17a2b8;
            color: white;
            border: none;
            padding: 5px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            margin-left: 10px; /* Ù„ØªØ±Ùƒ Ù…Ø³Ø§ÙØ© Ø¹Ù† Ø²Ø± Ø§Ù„Ø­Ø°Ù */
        }
        
        .answer-input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
        }
        
        .answer-input-group input[type="text"] {
            flex: 1;
        }
        
        .answer-input-group input[type="radio"] {
            cursor: pointer;
        }
        
        .remove-answer-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.8em;
        }
        
        .add-answer-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
        }
        
        .question-type-selector {
            margin-bottom: 15px;
        }
        
        .entity-update-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            border-right: 4px solid #667eea;
        }
        
        .entity-update-item small {
            color: #666;
            font-size: 0.85em;
        }
        
        .entity-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
            border: 2px solid #e0e0e0;
        }
        
        .entity-card h4 {
            margin: 0 0 10px 0;
            color: #333;
        }
        
        .entity-card-actions {
            margin-top: 15px;
            display: flex;
            gap: 10px;
        }
        
        .entity-card-actions button {
            flex: 1;
        }
        
        .stats-summary {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
        }
        
        .stats-summary h5 {
            margin: 0 0 10px 0;
            color: #667eea;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            font-size: 0.9em;
        }
    </style>
  <style>
    @view-transition {
      navigation: auto;
    }
    
    .answer-item {
      transition: all 0.3s ease;
    }
    
    .answer-item:hover {
      transform: translateX(-4px);
    }
    
    .correct-answer {
      background-color: #d4edda !important;
      border-color: #28a745 !important;
    }
    
    .delete-btn {
      transition: all 0.2s ease;
    }
    
    .delete-btn:hover {
      transform: scale(1.1);
    }
    
    @keyframes popIn {
      0% {
        transform: scale(0.5);
        opacity: 0;
      }
      50% {
        transform: scale(1.1);
      }
      100% {
        transform: scale(1);
        opacity: 1;
      }
    }
    
    @keyframes confetti {
      0% {
        transform: translateY(-100%) rotate(0deg);
        opacity: 1;
      }
      100% {
        transform: translateY(100vh) rotate(720deg);
        opacity: 0;
      }
    }
    
    .confetti-piece {
      position: fixed;
      width: 10px;
      height: 10px;
      animation: confetti 3s linear;
      pointer-events: none;
      z-index: 1001;
    }

    /* ğŸ†• Ø£Ù†Ù…Ø§Ø· Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù„Ù„Ø¹Ø¬Ù„Ø© - ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ø¯Ø§Ø®Ù„ Ù…Ù„Ù CSS Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ */
    #wheelPage .main-card {
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .wheel-content-wrapper {
        display: flex;
        gap: 20px;
        flex-wrap: wrap;
        width: 100%;
        max-width: 900px;
        justify-content: center;
        align-items: flex-start;
    }
    .wheel-section-new {
        flex: 1.5;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        position: relative;
        min-width: 0;
    }
    .sidebar-new {
        flex: 1;
        background: rgba(255,255,255,0.95);
        border-radius: 20px;
        padding: clamp(15px, 3vw, 25px);
        box-shadow: 0 8px 32px rgba(0,0,0,0.2);
        display: flex;
        flex-direction: column;
        overflow: hidden;
        min-width: 250px;
        height: 450px; /* Ù„ØªØ­Ø¯ÙŠØ¯ Ø§Ø±ØªÙØ§Ø¹ Ù…Ù†Ø§Ø³Ø¨ ÙÙŠ Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø£ÙÙ‚ÙŠ */
    }
    .names-textarea {
        flex: 1;
        min-height: 200px;
        padding: 15px;
        border: 2px solid #e0e0e0;
        border-radius: 10px;
        font-size: clamp(14px, 1.5vw, 16px);
        font-family: 'Arial', sans-serif;
        resize: none;
        transition: border-color 0.3s;
        line-height: 1.8;
    }
    .controls-new {
        margin-top: 20px;
        display: flex;
        flex-wrap: wrap;
        gap: 12px;
        align-items: center;
        justify-content: center;
        width: 100%;
        max-width: 400px;
    }
    .spin-button-new {
        background: #66bb6a;
        color: white;
        border: none;
        padding: clamp(12px, 2vw, 18px) clamp(30px, 5vw, 50px);
        font-size: clamp(16px, 2.5vw, 24px);
        font-weight: bold;
        border-radius: 50px;
        cursor: pointer;
        box-shadow: 0 4px 15px rgba(102,187,106,0.4);
        transition: all 0.3s;
        width: 100%;
    }
    .spin-button-new:hover:not(:disabled) {
        background: #57a35b;
        transform: translateY(-2px) scale(1.05);
        box-shadow: 0 6px 20px rgba(102,187,106,0.6);
    }
    .spin-button-new.spinning {
        animation: pulse 0.5s infinite;
    }
    @keyframes pulse {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.05); }
    }
    .winner-modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.8);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 1000;
        padding: 20px;
        box-sizing: border-box;
    }
    .winner-modal.show {
        display: flex;
    }
    .winner-content {
        background: white;
        padding: clamp(30px, 5vw, 50px);
        border-radius: 30px;
        text-align: center;
        box-shadow: 0 20px 60px rgba(0,0,0,0.4);
        animation: bounce-in 0.5s;
        max-width: 90%;
    }
    @keyframes bounce-in {
        0% { transform: scale(0); }
        50% { transform: scale(1.1); }
        100% { transform: scale(1); }
    }
    .winner-name-new {
        font-size: clamp(28px, 6vw, 48px);
        color: #66bb6a;
        font-weight: bold;
        margin: 0 0 30px 0;
        animation: glow 1.5s infinite;
        word-break: break-word;
    }
    @keyframes glow {
        0%, 100% { text-shadow: 0 0 10px rgba(102,187,106,0.5); }
        50% { text-shadow: 0 0 20px rgba(102,187,106,0.8); }
    }
    .close-button { /* ØªØµØ­ÙŠØ­ Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ù…Ø­ÙŠØ· Ø¨Ø²Ø± Ø±Ø§Ø¦Ø¹ */
        background: #64b5f6;
        color: white;
        border: none;
        padding: clamp(12px, 2vw, 15px) clamp(30px, 5vw, 40px);
        border-radius: 25px;
        font-size: clamp(14px, 2vw, 18px);
        cursor: pointer;
        transition: background 0.3s;
    }
    .delete-button-new {
        background: #e57373;
        color: white;
        border: none;
        padding: clamp(12px, 2vw, 15px) clamp(30px, 5vw, 40px);
        border-radius: 25px;
        font-size: clamp(14px, 2vw, 18px);
        cursor: pointer;
        transition: background 0.3s;
    }

    @media (max-width: 900px) {
      .wheel-content-wrapper {
        flex-direction: column;
        align-items: center;
      }
      .sidebar-new {
        order: 2;
        min-height: 250px;
        width: 100%;
        max-width: 400px;
        height: auto;
      }
      .wheel-section-new {
        order: 1;
      }
      .controls-new {
        width: 100%;
        max-width: 300px;
      }
    }
    /* Ù†Ù‡Ø§ÙŠØ© Ø£Ù†Ù…Ø§Ø· Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù„Ù„Ø¹Ø¬Ù„Ø© */
    
  </style>
 </head>
 <body>
  <div class="toast" id="toast"></div>
  <div class="container"><div id="homePage">
    <div class="header">
     <h1 id="mainTitle">Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø§Øª Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠ</h1>
     <p id="welcomeMessage">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨ÙƒÙ… ÙÙŠ Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø§Øª</p>
    </div>
    <div class="main-card">
     <div class="entity-selector"><label for="entitySelect">Ø§Ø®ØªØ± Ø§Ù„Ø¬Ù‡Ø© Ù„Ù„Ø¯Ø®ÙˆÙ„:</label> <select id="entitySelect"> <option value="">-- Ø§Ø®ØªØ± Ø¬Ù‡Ø© --</option> </select>
     </div><button class="btn" id="enterEntityBtn" disabled> <span id="enterButtonText">Ø¯Ø®ÙˆÙ„</span> </button>
     <div style="text-align: center; margin: 20px 0;">
      <div style="border-top: 2px solid #e0e0e0; margin: 20px 0;"></div>
      <p style="color: #666;">Ø£Ùˆ</p>
     </div>
     <div class="quick-access">
      <div class="access-card" onclick="showPublicQuizzes()">
       <h3>ğŸ¯</h3>
       <h3>Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©</h3>
       <p>Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø¨Ø§Ø´Ø± Ù„Ù„Ù…Ø³Ø§Ø¨Ù‚Ø§Øª</p>
      </div>
      <div class="access-card" onclick="showPublicLeaderboard()">
       <h3>ğŸ†</h3>
       <h3>Ù„ÙˆØ­Ø© Ø§Ù„ØµØ¯Ø§Ø±Ø©</h3>
       <p>Ø¹Ø±Ø¶ Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„Ø¹Ø§Ù…</p>
      </div>
      <div class="access-card" onclick="showWheelOfFortune()">
       <h3>ğŸ¡</h3>
       <h3>Ø¹Ø¬Ù„Ø© Ø§Ù„Ø­Ø¸</h3>
       <p>Ø¬Ø±Ø¨ Ø­Ø¸Ùƒ Ø§Ù„Ø¢Ù†</p>
      </div>
     </div>
     <div style="margin-top: 30px;"><button class="btn" id="superAdminBtn" onclick="showPage('superAdminLoginPage')"> <span id="adminButtonText">Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ø§Ù…Ø©</span> </button>
</div>n>
     </div>
    </div>
   </div><div id="superAdminLoginPage" class="hidden">
    <div class="main-card"><button class="back-btn" onclick="goToHome()">â† Ø§Ù„Ø¹ÙˆØ¯Ø©</button>
     <h2 class="section-title">ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ø§Ù…Ø©</h2>
     <form class="login-form" id="superAdminLoginForm" onsubmit="loginSuperAdmin(event)">
      <div class="form-group"><label>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:</label> <input type="text" id="superAdminUsername" required>
      </div>
      <div class="form-group"><label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:</label> <input type="password" id="superAdminPassword" required>
      </div><button type="submit" class="btn">Ø¯Ø®ÙˆÙ„</button>
     </form>
    </div>
   </div><div id="superAdminPage" class="hidden">
    <div class="main-card"><button class="back-btn" onclick="goToHome()">â† Ø§Ù„Ø¹ÙˆØ¯Ø©</button>
     <h2 class="section-title">Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ø§Ù…Ø©</h2>
     <div class="form-group"><label>Ø¥Ø¶Ø§ÙØ© Ø¬Ù‡Ø© Ø¬Ø¯ÙŠØ¯Ø©:</label> <input type="text" id="newEntityName" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¬Ù‡Ø©">
     </div>
     <div class="form-group"><label>Ø§Ø³Ù… Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù…Ø¯ÙŠØ±:</label> <input type="text" id="newEntityAdminUsername" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
     </div>
     <div class="form-group"><label>ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø§Ù„Ù…Ø¯ÙŠØ±:</label> <input type="password" id="newEntityAdminPassword" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
     </div><button class="btn btn-success" onclick="addNewEntity()">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¬Ù‡Ø©</button>
     <div style="margin-top: 40px;">
      <h3>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ:</h3>
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 30px;"><button class="btn btn-success" onclick="exportBackup()">ğŸ“¥ ØªØµØ¯ÙŠØ± Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©</button> <button class="btn" onclick="document.getElementById('importFileInput').click()">ğŸ“¤ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©</button>
      </div><input type="file" id="importFileInput" accept=".json" style="display: none;" onchange="importBackup(event)">
     </div>
     <div style="margin-top: 40px;">
      <h3>Ø§Ù„Ø¬Ù‡Ø§Øª Ø§Ù„Ù…Ø³Ø¬Ù„Ø©:</h3>
      <div id="entitiesList"></div>
     </div>
    </div>
   </div><div id="entityPage" class="hidden">
    <div class="main-card"><button class="back-btn" onclick="goToHome()">â† Ø§Ù„Ø¹ÙˆØ¯Ø©</button>
     <h2 class="section-title" id="entityPageTitle"></h2>
     <div class="entity-sections">
      <div class="section-card" onclick="showQuizzesSection()">
       <h3>ğŸ¯</h3>
       <h3>Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª ÙˆØ§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø§Øª</h3>
      </div>
      <div class="section-card" onclick="showLeaderboardSection()">
       <h3>ğŸ†</h3>
       <h3>Ù„ÙˆØ­Ø© Ø§Ù„ØµØ¯Ø§Ø±Ø©</h3>
      </div>
      <div class="section-card" onclick="showEntityAdminLogin()">
       <h3>âš™ï¸</h3>
       <h3>Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</h3>
      </div>
     </div>
    </div>
   </div><div id="entityAdminLoginPage" class="hidden">
    <div class="main-card"><button class="back-btn" onclick="goBackToEntity()">â† Ø§Ù„Ø¹ÙˆØ¯Ø©</button>
     <h2 class="section-title">ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</h2>
     <form class="login-form" id="entityAdminLoginForm" onsubmit="loginEntityAdmin(event)">
      <div class="form-group"><label>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:</label> <input type="text" id="entityAdminUsername" required>
      </div>
      <div class="form-group"><label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:</label> <input type="password" id="entityAdminPassword" required>
      </div><button type="submit" class="btn">Ø¯Ø®ÙˆÙ„</button>
     </form>
    </div>
   </div><div id="entityAdminPage" class="hidden">
    <div class="main-card"><button class="back-btn" onclick="goBackToEntity()">â† Ø§Ù„Ø¹ÙˆØ¯Ø©</button>
     <h2 class="section-title">Ù„ÙˆØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¬Ù‡Ø©</h2>
     <p style="text-align: center; color: #666; margin-bottom: 20px;">Ù…Ø³Ø¬Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„: <strong id="loggedInUserName"></strong> (<span id="userRole"></span>)</p>
     <div class="entity-sections">
      <div id="managerSection">
       <div class="section-card" onclick="showMembersManagement()">
        <h3>ğŸ§‘â€ğŸ¤â€ğŸ§‘</h3>
        <h3>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡</h3>
       </div>
      </div>
      <div class="section-card" onclick="showAddQuizForm()">
       <h3>â•</h3>
       <h3>Ø¥Ø¶Ø§ÙØ© Ù…Ø³Ø§Ø¨Ù‚Ø©</h3>
      </div>
      <div class="section-card" onclick="showMyQuizzes()">
       <h3>ğŸ“‹</h3>
       <h3>Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø§Øª ÙˆØ§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª</h3>
      </div>
     </div>
    </div>
   </div><div id="membersManagementPage" class="hidden">
    <div class="main-card"><button class="back-btn" onclick="goBackToEntityAdmin()">â† Ø§Ù„Ø¹ÙˆØ¯Ø©</button>
     <h2 class="section-title">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡</h2>
     <div class="form-group"><label>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù„Ù„Ø¹Ø¶Ùˆ Ø§Ù„Ø¬Ø¯ÙŠØ¯:</label> <input type="text" id="newMemberUsername" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
     </div>
     <div class="form-group"><label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:</label> <input type="password" id="newMemberPassword" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
     </div><button class="btn btn-success" onclick="addMember()">Ø¥Ø¶Ø§ÙØ© Ø¹Ø¶Ùˆ</button>
     <div class="member-list" id="membersList"></div>
    </div>
   </div><div id="addQuizPage" class="hidden">
    <div class="main-card"><button class="back-btn" onclick="goBackToEntityAdmin()">â† Ø§Ù„Ø¹ÙˆØ¯Ø©</button>
     <h2 class="section-title">Ø¥Ø¶Ø§ÙØ© Ù…Ø³Ø§Ø¨Ù‚Ø© / Ø§Ø®ØªØ¨Ø§Ø±</h2>
     <div class="form-group"><label>Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©:</label> <input type="text" id="quizTitle" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©">
     </div>
     <div class="form-group"><label>Ø§Ù„Ù†ÙˆØ¹:</label> <select id="quizType"> <option value="quiz">Ø§Ø®ØªØ¨Ø§Ø±</option> <option value="competition">Ù…Ø³Ø§Ø¨Ù‚Ø©</option> </select>
     </div>
     <div class="form-group"><label>Ø§Ù„Ø±Ø¤ÙŠØ©:</label> <select id="quizVisibility"> <option value="public">Ø¹Ø§Ù…</option> <option value="private">Ø®Ø§Øµ</option> </select>
     </div>
     <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
      <h3 style="margin-top: 0;">Ø§Ù„Ø£Ø³Ø¦Ù„Ø©:</h3>
      <div id="questionsContainer"></div><button class="btn btn-success" onclick="addQuestionForm()">â• Ø¥Ø¶Ø§ÙØ© Ø³Ø¤Ø§Ù„</button>
     </div><button class="btn btn-success" id="saveQuizBtn" onclick="saveQuiz()">Ø­ÙØ¸ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©</button>
    </div>
   </div><div id="myQuizzesPage" class="hidden">
    <div class="main-card"><button class="back-btn" onclick="goBackToEntityAdmin()">â† Ø§Ù„Ø¹ÙˆØ¯Ø©</button>
     <h2 class="section-title">Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø§Øª ÙˆØ§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª</h2>
     <div id="adminQuizzesList"></div>
    </div>
   </div><div id="quizzesPage" class="hidden">
    <div class="main-card"><button class="back-btn" id="quizzesBackBtn" onclick="goBackToEntity()">â† Ø§Ù„Ø¹ÙˆØ¯Ø©</button>
     <h2 class="section-title">Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª ÙˆØ§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø§Øª</h2>
     <div class="quiz-list" id="quizzesList"></div>
    </div>
   </div><div id="takeQuizPage" class="hidden">
    <div class="main-card"><button class="back-btn" onclick="goBackToQuizzes()">â† Ø§Ù„Ø¹ÙˆØ¯Ø©</button>
     <h2 class="section-title" id="quizTitle"></h2>
     <div class="form-group"><label>Ø§Ø³Ù…Ùƒ:</label> <input type="text" id="participantName" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ"> <button class="btn btn-success" id="startQuizBtn" style="margin-top: 15px;" onclick="startQuizQuestions()">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</button>
     </div>
     <div id="quizQuestionsContainer"></div>
    </div>
   </div><div id="leaderboardPage" class="hidden">
    <div class="main-card"><button class="back-btn" id="leaderboardBackBtn" onclick="goBackToEntity()">â† Ø§Ù„Ø¹ÙˆØ¯Ø©</button>
     <h2 class="section-title">Ù„ÙˆØ­Ø© Ø§Ù„ØµØ¯Ø§Ø±Ø©</h2>
     <table class="leaderboard-table" id="leaderboardTable">
      <thead>
       <tr>
        <th>Ø§Ù„ØªØ±ØªÙŠØ¨</th>
        <th>Ø§Ù„Ø§Ø³Ù…</th>
        <th>Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©</th>
        <th>Ø§Ù„Ù†ØªÙŠØ¬Ø©</th>
        <th>Ø§Ù„ÙˆÙ‚Øª (Ø«Ø§Ù†ÙŠØ©)</th>
       </tr>
      </thead>
      <tbody id="leaderboardBody"></tbody>
     </table>
    </div>
   </div>
   
   <div id="wheelPage" class="hidden">
    <div class="main-card" style="min-height: 80vh;">
      <button class="back-btn" onclick="goToHome()">â† Ø§Ù„Ø¹ÙˆØ¯Ø©</button>
      <h2 class="section-title">Ø¹Ø¬Ù„Ø© Ø§Ù„Ø­Ø¸</h2>
      
      <div class="wheel-content-wrapper">
        <section class="wheel-section-new">
          <div class="wheel-container-new">
            <div class="arrow-new" id="wheelArrow" style="border-top-color: #e57373;"></div>
            <canvas id="wheelCanvas" width="400" height="400" style="border-radius: 50%; border: 8px solid #ffffff; box-shadow: 0 0 30px rgba(0,0,0,0.3); width: 100%; height: 100%;"></canvas>
            <div class="center-circle-new"></div>
          </div>
          <div class="controls-new">
            <button class="spin-button-new" id="spinButton" style="background-color: #66bb6a;">
              Ø£Ø¯Ø± Ø§Ù„Ø¹Ø¬Ù„Ø©
            </button>
          </div>
        </section>
        <aside class="sidebar-new">
          <h2 class="sidebar-title">Ø£Ø¯Ø®Ù„ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡</h2>
          <textarea class="names-textarea" id="namesTextarea" placeholder="Ø£Ø¯Ø®Ù„ Ø£Ø³Ù…Ø§Ø¡ Ù…ØªØ¹Ø¯Ø¯Ø© (ÙƒÙ„ Ø§Ø³Ù… ÙÙŠ Ø³Ø·Ø±)
Ù…Ø«Ø§Ù„:
Ù…Ø­Ù…Ø¯
ÙØ§Ø·Ù…Ø©
Ø¹Ù„ÙŠ
Ù†ÙˆØ±"></textarea>
        </aside>
      </div>
      
    </div>
   </div>
   <div id="participantsDetailsPage" class="hidden">
    <div class="main-card"><button class="back-btn" onclick="goBackToMyQuizzes()">â† Ø§Ù„Ø¹ÙˆØ¯Ø©</button>
     <h2 class="section-title" id="participantsQuizTitle"></h2>
     <div id="participantsDetailsList"></div>
    </div>
   </div>
   
   <div id="celebration-overlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 1000; justify-content: center; align-items: center;">
      <div id="celebration-content" style="background: white; padding: 40px; border-radius: 20px; text-align: center; max-width: 400px; animation: popIn 0.5s ease-out;">
        <div id="celebration-emoji" style="font-size: 80px; margin-bottom: 20px;">ğŸ‰</div>
        <div id="celebration-message" style="font-size: 24px; font-weight: bold; margin-bottom: 20px;"></div>
        <button id="celebration-close" style="background: #667eea; color: white; padding: 12px 24px; border: none; border-radius: 8px; cursor: pointer; font-size: 16px;">Ù…ØªØ§Ø¨Ø¹Ø©</button>
      </div>
    </div>
    
    <div class="winner-modal" id="winnerModal">
Â  Â <div class="winner-content">
Â  Â  <div class="winner-emoji">
Â  Â  Â ğŸ‰
Â  Â  </div>
Â  Â  <h2 class="winner-title" id="winnerMessage">Ø§Ù„ÙØ§Ø¦Ø² Ù‡Ùˆ</h2>
Â  Â  <div class="winner-name-new" id="winnerName"></div>
Â  Â  <div class="modal-buttons"><button class="close-button" id="closeModal">Ø±Ø§Ø¦Ø¹!</button> <button class="delete-button-new" id="deleteWinner">Ø­Ø°Ù Ø§Ù„ÙØ§Ø¦Ø²</button>
Â  Â  </div>
Â  Â </div>
Â  </div>
   
  </div>
  <script>
    // ----------------------------------------------------------------------------------
    // ğŸ†• Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ© Ù„Ù„Ø±Ø¨Ø· Ø¨Ù€ FIREBASE FIRESTORE
    // ----------------------------------------------------------------------------------
    window.dataSdk = {
        // 1. Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©: Ø¬Ù„Ø¨ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©
        async get() {
            try {
                const snapshot = await db.collection(COLLECTION_NAME).get();
                const data = snapshot.docs.map(doc => ({
                    ...doc.data(),
                    __backendId: doc.id, // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ØªÙ†Ø¯ ÙƒÙ€ __backendId
                    id: doc.data().id || doc.id // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø­Ù‚Ù„ 'id' Ø£Ùˆ Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ØªÙ†Ø¯
                }));
                return { isOk: true, data: data };
            } catch (error) {
                console.error("Firebase GET failed:", error);
                return { isOk: false, error: error };
            }
        },
        
        // 2. Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡: Ø¥Ø¶Ø§ÙØ© Ø³Ø¬Ù„ Ø¬Ø¯ÙŠØ¯ (Ù…Ø«Ù„Ø§Ù‹ Ø¬Ù‡Ø© Ø£Ùˆ Ù†ØªÙŠØ¬Ø©)
        async create(data) {
            try {
                // Ø­Ø°Ù Ù…Ø¹Ø±ÙØ§Øª Ø§Ù„Ù€ Mock Ù‚Ø¨Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„
                const dataToSave = { ...data };
                delete dataToSave.__backendId; 
                
                const docRef = await db.collection(COLLECTION_NAME).add(dataToSave);
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ø¬Ù„ Ø¨Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ØªÙ†Ø¯ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ (Firestore ID)
                await docRef.update({ id: docRef.id });

                return { isOk: true, result: { __backendId: docRef.id } };
            } catch (error) {
                console.error("Firebase CREATE failed:", error);
                return { isOk: false, error: error };
            }
        },

        // 3. Ø§Ù„ØªØ­Ø¯ÙŠØ«: ØªØ­Ø¯ÙŠØ« Ø³Ø¬Ù„ Ù…ÙˆØ¬ÙˆØ¯
        async update(data) {
            if (!data.__backendId) return { isOk: false, error: "Missing __backendId" };
            try {
                const docId = data.__backendId;
                // Ø­Ø°Ù Ù…Ø¹Ø±ÙØ§Øª Ø§Ù„Ù€ Mock Ù‚Ø¨Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„
                const dataToUpdate = { ...data };
                delete dataToUpdate.__backendId;
                
                await db.collection(COLLECTION_NAME).doc(docId).update(dataToUpdate);
                return { isOk: true };
            } catch (error) {
                console.error("Firebase UPDATE failed:", error);
                return { isOk: false, error: error };
            }
        },
        
        // 4. Ø§Ù„Ø­Ø°Ù: Ø­Ø°Ù Ø³Ø¬Ù„
        async delete(data) {
            if (!data.__backendId) return { isOk: false, error: "Missing __backendId" };
            try {
                await db.collection(COLLECTION_NAME).doc(data.__backendId).delete();
                return { isOk: true };
            } catch (error) {
                console.error("Firebase DELETE failed:", error);
                return { isOk: false, error: error };
            }
        },
        
        // 5. Ø§Ù„ØªÙ‡ÙŠØ¦Ø© (ØªØ³ØªØ®Ø¯Ù… Ù„Ø±Ø¨Ø· dataHandler Ø¨Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª ÙˆØªÙˆÙÙŠØ± Realtime): 
        async init(dataHandler) {
            try {
                // Ù‡Ø°Ø§ ÙŠØ³Ù…Ø­ Ù„Ù€ Firebase Ø¨ØªØ­Ø¯ÙŠØ« dataHandler Ø¹Ù†Ø¯ ÙˆØ¬ÙˆØ¯ ØªØºÙŠÙŠØ±Ø§Øª (Realtime)
                db.collection(COLLECTION_NAME).onSnapshot(snapshot => {
                    const data = snapshot.docs.map(doc => ({
                        ...doc.data(),
                        __backendId: doc.id,
                        id: doc.data().id || doc.id
                    }));
                    dataHandler.onDataChanged(data);
                });
                return { isOk: true };
            } catch (error) {
                console.error("Firebase INIT failed:", error);
                return { isOk: false, error: error };
            }
        }
    };
    // ----------------------------------------------------------------------------------
    // Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ©
    // ----------------------------------------------------------------------------------
        const MASTER_USERNAME = 'admin';
        const MASTER_PASSWORD = 'master123';
        
        let allData = [];
        let currentEntityId = null;
        let currentUserId = null;
        let currentUserRole = null;
        let currentQuizId = null;
        let quizStartTime = null;
        let isSuperAdmin = false;
        
        const defaultConfig = {
            main_title: 'Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø§Øª Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠ',
            welcome_message: 'Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨ÙƒÙ… ÙÙŠ Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø§Øª',
            enter_button: 'Ø¯Ø®ÙˆÙ„',
            admin_button: 'Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ø§Ù…Ø©',
            primary_color: '#667eea',
            secondary_color: '#764ba2',
            text_color: '#333333',
            success_color: '#28a745',
            danger_color: '#dc3545',
            font_family: 'Segoe UI',
            font_size: 16
        };

        const dataHandler = {
            async onDataChanged(data) {
                allData = data;
               
                updateEntitySelect();
                if (document.getElementById('entitiesList')) {
                    renderEntitiesList();
                }
                if (document.getElementById('adminQuizzesList')) {
                    renderAdminQuizzes();
                }
                if (document.getElementById('quizzesList')) {
                    renderQuizzesList();
                }
                if (document.getElementById('leaderboardBody')) {
                    renderLeaderboard();
                }
                if (document.getElementById('membersList')) {
                    renderMembersList();
                }
            }
        };

        async function onConfigChange(config) {
            document.getElementById('mainTitle').textContent = config.main_title || defaultConfig.main_title;
            document.getElementById('welcomeMessage').textContent = config.welcome_message || defaultConfig.welcome_message;
            document.getElementById('enterButtonText').textContent = config.enter_button || defaultConfig.enter_button;
            document.getElementById('adminButtonText').textContent = config.admin_button || defaultConfig.admin_button;
            
            const customFont = config.font_family || defaultConfig.font_family;
            const baseSize = config.font_size || defaultConfig.font_size;
            document.body.style.fontFamily = `${customFont}, sans-serif`;
            document.body.style.fontSize = `${baseSize}px`;
        }
        
        const STATE_KEY = 'last_page_id'; // Ù…ÙØªØ§Ø­ Ø§Ù„Ø­ÙØ¸ ÙÙŠ localStorage
        const ENTITY_KEY = 'current_entity_id'; // Ù…ÙØªØ§Ø­ Ø­ÙØ¸ Ù…Ø¹Ø±Ù Ø§Ù„Ø¬Ù‡Ø©

        async function initApp() {
            // âœ… ØªÙ‡ÙŠØ¦Ø© dataSdk Ø§Ù„Ø¢Ù† ØªØªØµÙ„ Ø¨Ù€ Firebase ÙˆØªÙØ¹Ù„ Ø§Ù„Ù€ Realtime
            const dataInitResult = await window.dataSdk.init(dataHandler);
            if (!dataInitResult.isOk) {
                showToast('ÙØ´Ù„ ØªÙ‡ÙŠØ¦Ø© Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§ØªØµØ§Ù„ Firebase.', true);
            }
            
            // Ù„Ø§ Ø­Ø§Ø¬Ø© Ù„Ù€ elementSdk Ø­ÙŠØ« ØªÙ… Ø¥Ø²Ø§Ù„ØªÙ‡ØŒ Ù„ÙƒÙ† Ù†Ø¨Ù‚ÙŠ Ø§Ù„ÙƒÙˆØ¯ ÙƒÙ…Ø§ Ù‡Ùˆ
            if (window.elementSdk) {
                window.elementSdk.init({
                    defaultConfig,
                    onConfigChange,
                    mapToCapabilities: (config) => ({
                        recolorables: [
                            {
                                get: () => config.primary_color || defaultConfig.primary_color,
                                set: (value) => {
                                    window.elementSdk.config.primary_color = value;
                                    window.elementSdk.setConfig({ primary_color: value });
                                }
                            }
                        ],
                        borderables: [],
                        fontEditable: {
                            get: () => config.font_family || defaultConfig.font_family,
                            set: (value) => {
                                window.elementSdk.config.font_family = value;
                                window.elementSdk.setConfig({ font_family: value });
                            }
                        },
                        fontSizeable: {
                            get: () => config.font_size || defaultConfig.font_size,
                            set: (value) => {
                                window.elementSdk.config.font_size = value;
                                window.elementSdk.setConfig({ font_size: value });
                            }
                        }
                    }),
                    mapToEditPanelValues: (config) => new Map([
                        ['main_title', config.main_title || defaultConfig.main_title],
                        ['welcome_message', config.welcome_message || defaultConfig.welcome_message],
                        ['enter_button', config.enter_button || defaultConfig.enter_button],
                        ['admin_button', config.admin_button || defaultConfig.admin_button]
                    ])
                });
            }

            document.getElementById('entitySelect').addEventListener('change', function() {
                document.getElementById('enterEntityBtn').disabled = !this.value;
            });

            document.getElementById('enterEntityBtn').addEventListener('click', function() {
                const entityId = document.getElementById('entitySelect').value;
                if (entityId) {
                    currentEntityId = entityId;
                    showEntityPage();
                }
            });

            document.getElementById('superAdminBtn').addEventListener('click', function() {
                showPage('superAdminLoginPage');
            });

            // ğŸ†• Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
            const lastPageId = localStorage.getItem(STATE_KEY);
            const savedEntityId = localStorage.getItem(ENTITY_KEY);
            
            if (lastPageId && lastPageId !== 'homePage') {
                if (lastPageId === 'superAdminPage') {
                    // Ø§Ù„Ù…Ø´Ø±Ù Ø§Ù„Ø¹Ø§Ù…: ÙŠØ¬Ø¨ Ø¥Ø¹Ø§Ø¯Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ø£Ø³Ø¨Ø§Ø¨ Ø£Ù…Ù†ÙŠØ©
                    showToast('ØªÙ…Øª Ø¥Ø¹Ø§Ø¯Ø© ØªÙˆØ¬ÙŠÙ‡Ùƒ Ø¥Ù„Ù‰ ØµÙØ­Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ØŒ ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.', true);
                    showPage('superAdminLoginPage');
                    
                } else if (savedEntityId) {
                    // Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø¬Ù‡Ø© ÙˆØ§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù„Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙØ­Ø©
                    currentEntityId = savedEntityId;
                    
                    if (lastPageId.includes('Admin') || lastPageId.includes('Management') || lastPageId.includes('myQuizzes')) {
                        // ØµÙØ­Ø§Øª ØªØªØ·Ù„Ø¨ ØµÙ„Ø§Ø­ÙŠØ§Øª (Ù„Ù† Ù†Ø¹ÙŠØ¯ Ø§Ù„Ø¯Ø®ÙˆÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§)
                        showEntityPage();
                        showToast('ØªÙ… Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø¬Ù‡Ø©. ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙƒÙ…Ø¯ÙŠØ± Ø£Ùˆ Ø¹Ø¶Ùˆ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.', false);
                    } else {
                        // ØµÙØ­Ø§Øª Ø¹Ø§Ù…Ø© Ø¯Ø§Ø®Ù„ Ø§Ù„Ø¬Ù‡Ø© (Ù…Ø«Ù„ Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø§Øª Ø£Ùˆ Ù„ÙˆØ­Ø© Ø§Ù„ØµØ¯Ø§Ø±Ø©)
                        showPage(lastPageId);
                        showToast('ØªÙ… Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø¢Ø®Ø± ØµÙØ­Ø© ÙƒÙ†Øª Ø¹Ù„ÙŠÙ‡Ø§.', false);
                    }
                } else {
                    // Ø¥Ø°Ø§ Ù„Ù… Ù†Ø¬Ø¯ Ù…Ø¹Ø±Ù Ø§Ù„Ø¬Ù‡Ø©ØŒ Ù†Ø¹ÙˆØ¯ Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
                    showPage('homePage');
                }
            } else {
                showPage('homePage');
            }
            
            // ğŸ†• ØªÙ‡ÙŠØ¦Ø© Ø¹Ø¬Ù„Ø© Ø§Ù„Ø­Ø¸ Ø¹Ù†Ø¯ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
            initWheel(); 
        }

        function updateEntitySelect() {
            const select = document.getElementById('entitySelect');
            const currentValue = select.value;
            // âœ… ØªÙ… Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ø®Ø·Ø£ Ø§Ù„Ù†ØµÙŠ: -- Ø§Ø®ØªØ± Ø¬Ù‡Ø© --
            select.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø¬Ù‡Ø© --</option>';
            
            const entities = allData.filter(item => item.type === 'entity');
            entities.forEach(entity => {
                const option = document.createElement('option');
                option.value = entity.id;
                option.textContent = entity.entity_name;
                select.appendChild(option);
            });
            
            if (currentValue) {
                select.value = currentValue;
            }
        }

        function showPage(pageId) {
            const pages = ['homePage', 'superAdminLoginPage', 'superAdminPage', 'entityPage', 
                          'entityAdminLoginPage', 'entityAdminPage', 'quizzesPage', 
                          'takeQuizPage', 'leaderboardPage', 'wheelPage', 'membersManagementPage',
                          'addQuizPage', 'myQuizzesPage', 'participantsDetailsPage'];
            
            // Ø¥Ø²Ø§Ù„Ø© ÙØ¦Ø© 'hidden' Ù…Ù† Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
            pages.forEach(id => {
                document.getElementById(id).classList.add('hidden');
            });
            document.getElementById(pageId).classList.remove('hidden');
            
            // ğŸ†• Ø­ÙØ¸ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© ÙˆÙ…Ø¹Ø±Ù Ø§Ù„Ø¬Ù‡Ø© ÙÙŠ localStorage Ø¨Ø§Ø³ØªØ«Ù†Ø§Ø¡ ØµÙØ­Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„
            const excludedPages = ['homePage', 'superAdminLoginPage', 'entityAdminLoginPage', 'takeQuizPage'];
            if (!excludedPages.includes(pageId)) {
                localStorage.setItem(STATE_KEY, pageId);
                if (currentEntityId) {
                    localStorage.setItem(ENTITY_KEY, currentEntityId);
                }
            } else if (pageId === 'homePage') {
                // Ø­Ø°Ù Ø§Ù„Ø­Ø§Ù„Ø© Ø¹Ù†Ø¯ Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
                localStorage.removeItem(STATE_KEY);
                localStorage.removeItem(ENTITY_KEY);
            }
        }

        function goToHome() {
            currentEntityId = null;
            currentUserId = null;
            currentUserRole = null;
            isSuperAdmin = false;
            showPage('homePage');
        }

        function showEntityPage() {
            const entity = allData.find(item => item.type === 'entity' && item.id === currentEntityId);
            if (entity) {
                document.getElementById('entityPageTitle').textContent = entity.entity_name;
                showPage('entityPage');
            }
        }

        function goBackToEntity() {
            currentUserId = null;
            currentUserRole = null;
            showEntityPage();
        }
        
        function goBackToEntityAdmin() {
            showPage('entityAdminPage');
        }
        
        function showMembersManagement() {
            renderMembersList();
            showPage('membersManagementPage');
        }
        
        function showAddQuizForm() {
            document.getElementById('questionsContainer').innerHTML = '';
            document.getElementById('quizTitle').value = '';
            
            // âœ… Ø§Ù„Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ù…Ù†Ø·Ù‚ÙŠ: Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ù„Ø¶Ù…Ø§Ù† Ø¨Ø¯Ø¡ ØªØ±Ù‚ÙŠÙ… Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ù…Ù† 1
            questionCounter = 0; 
            
            showPage('addQuizPage');
        }
        
        function showMyQuizzes() {
            renderAdminQuizzes();
            showPage('myQuizzesPage');
        }
        
        function goBackToMyQuizzes() {
            showMyQuizzes();
        }
        
        function showQuizParticipants(quizBackendId) {
            const quiz = allData.find(item => item.__backendId === quizBackendId);
            if (!quiz) return;
            
            document.getElementById('participantsQuizTitle').textContent = 'Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ† - ' + quiz.quiz_title;
            
            const results = allData.filter(item => item.type === 'result' && item.quiz_title === quiz.quiz_title && item.entity_id === currentEntityId);
            const questions = JSON.parse(quiz.questions);
            
            const container = document.getElementById('participantsDetailsList');
            
            if (results.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù„Ø¹Ø±Ø¶Ù‡Ø§</p>';
                showPage('participantsDetailsPage');
                return;
            }
            
            results.sort((a, b) => {
                if (b.score !== a.score) return b.score - a.score;
                return a.time_taken - b.time_taken;
            });
            
            container.innerHTML = results.map((result, rank) => {
                const completedDate = new Date(result.completed_at);
                const dateStr = completedDate.toLocaleDateString('ar-SA');
                const timeStr = completedDate.toLocaleTimeString('ar-SA');
                
                return `
                    <div class="entity-card" style="border-right: 5px solid ${rank === 0 ? '#ffd700' : rank === 1 ? '#c0c0c0' : rank === 2 ? '#cd7f32' : '#667eea'};">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <div>
                                <h4 style="margin: 0;">ğŸ… Ø§Ù„Ù…Ø±ÙƒØ² ${rank + 1}: ${result.participant_name}</h4>
                                <p style="margin: 5px 0; color: #666;">Ø§Ù„Ù†ØªÙŠØ¬Ø©: ${result.score.toFixed(2)} Ù…Ù† ${questions.length} | Ø§Ù„ÙˆÙ‚Øª: ${result.time_taken} Ø«Ø§Ù†ÙŠØ©</p>
                                <p style="margin: 5px 0; color: #999; font-size: 0.9em;">${dateStr} - ${timeStr}</p>
                            </div>
                        </div>
                        <button class="btn" style="padding: 8px 20px; margin-top: 10px;" onclick="showParticipantAnswers('${result.__backendId}', '${quiz.__backendId}')">ğŸ“„ Ø¹Ø±Ø¶ Ù…Ù„Ø®Øµ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª</button>
                    </div>
                `;
            }).join('');
            
            showPage('participantsDetailsPage');
        }
        
        function showParticipantAnswers(resultBackendId, quizBackendId) {
            const result = allData.find(item => item.__backendId === resultBackendId);
            const quiz = allData.find(item => item.__backendId === quizBackendId);
            if (!result || !quiz) return;
            
            const questions = JSON.parse(quiz.questions);
            const participantAnswers = result.user_answers ? JSON.parse(result.user_answers) : null;
            
            const modal = document.createElement('div');
            modal.style.cssText = 'position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); z-index: 2000; overflow-y: auto; padding: 20px;';
            modal.onclick = (e) => {
                if (e.target === modal) modal.remove();
            };
            
            const modalContent = document.createElement('div');
            modalContent.style.cssText = 'background: white; max-width: 900px; margin: 0 auto; border-radius: 15px; padding: 30px; position: relative;';
            
            const completedDate = new Date(result.completed_at);
            const dateStr = completedDate.toLocaleDateString('ar-SA');
            const timeStr = completedDate.toLocaleTimeString('ar-SA');
            
            modalContent.innerHTML = `
                <button onclick="this.closest('[style*=fixed]').remove()" style="position: absolute; top: 15px; left: 15px; background: #dc3545; color: white; border: none; width: 35px; height: 35px; border-radius: 50%; font-size: 1.2em; cursor: pointer; font-weight: bold;">Ã—</button>
                
                <div style="text-align: center; padding: 25px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 15px; margin-bottom: 25px;">
                    <h2 style="margin: 0 0 10px 0;">Ù…Ù„Ø®Øµ Ø¥Ø¬Ø§Ø¨Ø§Øª: ${result.participant_name}</h2>
                    <p style="margin: 0; font-size: 1.3em;"><strong>Ø§Ù„Ù†ØªÙŠØ¬Ø©:</strong> ${result.score.toFixed(2)} Ù…Ù† ${questions.length} (${Math.round((result.score / questions.length) * 100)}%)</p>
                    <p style="margin: 5px 0;"><strong>Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ø³ØªØºØ±Ù‚:</strong> ${result.time_taken} Ø«Ø§Ù†ÙŠØ©</p>
                    <p style="margin: 5px 0; font-size: 0.9em; opacity: 0.9;">${dateStr} - ${timeStr}</p>
                </div>
                
                <h3 style="margin-bottom: 20px; color: #333;">Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„ØªÙØµÙŠÙ„ÙŠØ©:</h3>
                <div style="max-height: 60vh; overflow-y: auto;">
                    ${participantAnswers ? generateDetailedAnswersSummary(participantAnswers, questions) : generateParticipantAnswersSummary(result, questions)}
                </div>
            `;
            
            modal.appendChild(modalContent);
            document.body.appendChild(modal);
        }
        
        function generateParticipantAnswersSummary(result, questions) {
            let html = '';
            let currentScore = 0;
            
            questions.forEach((q, index) => {
                let isCorrect = false;
                let partialScore = 0;
                let answerText = '<span style="color: #999; font-style: italic;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø¬Ø§Ø¨Ø© Ù…Ø³Ø¬Ù„Ø©</span>';
                let correctAnswerText = '';
                
                if (q.type === 'multiple') {
                    correctAnswerText = q.answers[q.correct];
                    // âœ… ØªÙ… Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ø®Ø·Ø£ Ø§Ù„Ù†ØµÙŠ: ØºÙŠØ± Ù…ØªÙˆÙØ±Ø©
                    answerText = '<span style="color: #999; font-style: italic;">ØºÙŠØ± Ù…ØªÙˆÙØ±Ø©</span>';
                } else if (q.type === 'truefalse') {
                    correctAnswerText = q.correct ? 'ØµØ­' : 'Ø®Ø·Ø£';
                    answerText = '<span style="color: #999; font-style: italic;">ØºÙŠØ± Ù…ØªÙˆÙØ±Ø©</span>';
                } else if (q.type === 'text') {
                    correctAnswerText = q.correct;
                    answerText = '<span style="color: #999; font-style: italic;">ØºÙŠØ± Ù…ØªÙˆÙØ±Ø©</span>';
                } else if (q.type === 'checkbox') {
                    correctAnswerText = q.correct.map(i => q.answers[i]).join(' ØŒ ');
                    answerText = '<span style="color: #999; font-style: italic;">ØºÙŠØ± Ù…ØªÙˆÙØ±Ø©</span>';
                } else if (q.type === 'matching') {
                    correctAnswerText = q.pairs.map(p => `${p.left} âŸ· ${p.right}`).join(' | ');
                    answerText = '<span style="color: #999; font-style: italic;">ØºÙŠØ± Ù…ØªÙˆÙØ±Ø©</span>';
                } else if (q.type === 'ordering') {
                    correctAnswerText = q.correctOrder.join(' â† ');
                    answerText = '<span style="color: #999; font-style: italic;">ØºÙŠØ± Ù…ØªÙˆÙØ±Ø©</span>';
                }
                
                const expectedScoreForQuestion = (result.score / questions.length);
                
                if (expectedScoreForQuestion >= 0.9) {
                    isCorrect = true;
                    partialScore = 1;
                } else if (expectedScoreForQuestion > 0) {
                    partialScore = expectedScoreForQuestion;
                }
                
                currentScore += partialScore;
                
                const bgColor = isCorrect ? '#d4edda' : (partialScore > 0 ? '#fff3cd' : '#f8d7da');
                const borderColor = isCorrect ? '#28a745' : (partialScore > 0 ? '#ffc107' : '#dc3545');
                const icon = isCorrect ? 'âœ“' : (partialScore > 0 ? 'â—' : 'âœ—');
                
                html += `
                    <div style="padding: 20px; background: ${bgColor}; border-radius: 10px; margin-bottom: 15px; border-right: 5px solid ${borderColor};">
                        <h4 style="margin: 0 0 10px 0;">${icon} Ø§Ù„Ø³Ø¤Ø§Ù„ ${index + 1}: ${q.question}</h4>
                        <p style="margin: 5px 0;"><strong>Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„Ù…Ø´Ø§Ø±Ùƒ:</strong> ${answerText}</p>
                        <p style="margin: 5px 0; color: #155724;"><strong>Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ÙŠØ©:</strong> ${correctAnswerText}</p>
                        ${partialScore > 0 && partialScore < 1 ? `<p style="margin: 5px 0; color: #856404;"><strong>Ø§Ù„Ù†Ù‚Ø§Ø·:</strong> ${partialScore.toFixed(2)}/1</p>` : ''}
                    </div>
                `;
            });
            
            return html;
        }
        
        function generateDetailedAnswersSummary(participantAnswers, questions) {
            let html = '';
            
            participantAnswers.forEach((answer, index) => {
                const q = questions[index];
                let isCorrect = answer.isCorrect || false;
                let partialScore = answer.partialScore || 0;
                let userAnswerText = '';
                let correctAnswerText = '';
                
                if (q.type === 'multiple') {
                    userAnswerText = answer.userAnswer !== null && answer.userAnswer !== undefined ? q.answers[answer.userAnswer] : '<span style="color: #999;">Ù„Ù… ÙŠØ¬Ø¨</span>';
                    correctAnswerText = q.answers[q.correct];
                } else if (q.type === 'truefalse') {
                    userAnswerText = answer.userAnswer !== null && answer.userAnswer !== undefined ? (answer.userAnswer ? 'ØµØ­' : 'Ø®Ø·Ø£') : '<span style="color: #999;">Ù„Ù… ÙŠØ¬Ø¨</span>';
                    correctAnswerText = q.correct ? 'ØµØ­' : 'Ø®Ø·Ø£';
                } else if (q.type === 'text') {
                    userAnswerText = answer.userAnswer || '<span style="color: #999;">Ù„Ù… ÙŠØ¬Ø¨</span>';
                    correctAnswerText = q.correct;
                } else if (q.type === 'checkbox') {
                    userAnswerText = answer.userAnswer && answer.userAnswer.length > 0 ? answer.userAnswer.map(i => q.answers[i]).join(' ØŒ ') : '<span style="color: #999;">Ù„Ù… ÙŠØ¬Ø¨</span>';
                    correctAnswerText = q.correct.map(i => q.answers[i]).join(' ØŒ ');
                } else if (q.type === 'matching') {
                    if (answer.userAnswer && answer.userAnswer.length > 0) {
                        userAnswerText = q.pairs.map((p, i) => `${p.left} âŸ· ${answer.userAnswer[i] || 'ØŸ'}`).join(' | ');
                    } else {
                        userAnswerText = '<span style="color: #999;">Ù„Ù… ÙŠØ¬Ø¨</span>';
                    }
                    correctAnswerText = q.pairs.map(p => `${p.left} âŸ· ${p.right}`).join(' | ');
                } else if (q.type === 'ordering') {
                    userAnswerText = answer.userAnswer && answer.userAnswer.length > 0 ? answer.userAnswer.join(' â† ') : '<span style="color: #999;">Ù„Ù… ÙŠØ¬Ø¨</span>';
                    correctAnswerText = q.correctOrder.join(' â† ');
                }
                
                const bgColor = isCorrect ? '#d4edda' : (partialScore > 0 ? '#fff3cd' : '#f8d7da');
                const borderColor = isCorrect ? '#28a745' : (partialScore > 0 ? '#ffc107' : '#dc3545');
                const icon = isCorrect ? 'âœ“' : (partialScore > 0 ? 'â—' : 'âœ—');
                
                html += `
                    <div style="padding: 20px; background: ${bgColor}; border-radius: 10px; margin-bottom: 15px; border-right: 5px solid ${borderColor};">
                        <h4 style="margin: 0 0 10px 0;">${icon} Ø§Ù„Ø³Ø¤Ø§Ù„ ${index + 1}: ${q.question}</h4>
                        <p style="margin: 5px 0;"><strong>Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„Ù…Ø´Ø§Ø±Ùƒ:</strong> ${userAnswerText}</p>
                        <p style="margin: 5px 0; color: #155724;"><strong>Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©:</strong> ${correctAnswerText}</p>
                        ${partialScore > 0 && partialScore < 1 ? `<p style="margin: 5px 0; color: #856404;"><strong>Ø§Ù„Ù†Ù‚Ø§Ø·:</strong> ${partialScore.toFixed(2)}/1</p>` : ''}
                    </div>
                `;
            });
            
            return html;
        }

        async function loginSuperAdmin(event) {
            event.preventDefault();
            const username = document.getElementById('superAdminUsername').value;
            const password = document.getElementById('superAdminPassword').value;
            
            if (username === MASTER_USERNAME && password === MASTER_PASSWORD) {
                isSuperAdmin = true;
                showPage('superAdminPage');
                renderEntitiesList();
            } else {
                // âœ… ØªÙ… Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ø®Ø·Ø£ Ø§Ù„Ù†ØµÙŠ: Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
                showToast('Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©', true);
            }
        }

        // ------------------------------------------
        // âœ… Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ù…Ø­Ø¯Ø«Ø© Ù„Ø­Ù„ Ù…Ø´ÙƒÙ„Ø© Ø²Ø± "Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¬Ù‡Ø©" ÙˆØ§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ø­Ù„ÙŠ
        // ------------------------------------------
        async function addNewEntity() {
            if (allData.length >= 999) {
                showToast('ØªÙ… Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù…Ù† Ø§Ù„Ø¬Ù‡Ø§Øª (999)', true);
                return;
            }

            const name = document.getElementById('newEntityName').value;
            const username = document.getElementById('newEntityAdminUsername').value;
            const password = document.getElementById('newEntityAdminPassword').value;
            
            if (!name || !username || !password) {
                showToast('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„', true);
                return;
            }
            
            const entityId = 'entity_' + Date.now();
            const result = await window.dataSdk.create({
                id: entityId,
                type: 'entity',
                entity_id: entityId,
                entity_name: name,
                admin_username: username,
                admin_password: password,
                members: JSON.stringify([])
            });
            
            if (result.isOk) {
                showToast('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¬Ù‡Ø© Ø¨Ù†Ø¬Ø§Ø­');
                document.getElementById('newEntityName').value = '';
                document.getElementById('newEntityAdminUsername').value = '';
                document.getElementById('newEntityAdminPassword').value = '';
            } else {
                showToast('ÙØ´Ù„ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¬Ù‡Ø©', true);
            }
        }
        // ------------------------------------------
        // Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ù…Ø­Ø¯Ø«Ø©
        // ------------------------------------------


        function renderEntitiesList() {
            const container = document.getElementById('entitiesList');
            if (!container) return;
            
            const entities = allData.filter(item => item.type === 'entity');
            
            if (entities.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¬Ù‡Ø§Øª Ù…Ø³Ø¬Ù„Ø©</p>';
                return;
            }
            
            container.innerHTML = entities.map(entity => {
                const members = JSON.parse(entity.members || '[]');
                const quizzes = allData.filter(item => item.type === 'quiz' && item.entity_id === entity.id);
                
                return `
                    <div class="entity-card">
                        <h4>${entity.entity_name}</h4>
                        <p style="margin: 5px 0; color: #666;">
                            <strong>Ø§Ù„Ù…Ø¯ÙŠØ±:</strong> ${entity.admin_username}<br>
                            <strong>Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡:</strong> ${members.length}<br>
                            <strong>Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø§Øª:</strong> ${quizzes.length}
                        </p>
                        <div class="entity-card-actions">
                            <button class="btn" style="padding: 8px 20px;" onclick="editEntityCredentials('${entity.__backendId}')">ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¯ÙŠØ±</button>
                            <button class="btn btn-danger" style="padding: 8px 20px;" onclick="deleteEntity('${entity.__backendId}')">Ø­Ø°Ù</button>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function editEntityCredentials(backendId) {
            const entity = allData.find(item => item.__backendId === backendId);
            if (!entity) return;
            
            const newUsername = document.createElement('div');
            newUsername.style.cssText = 'position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 30px; border-radius: 15px; box-shadow: 0 10px 40px rgba(0,0,0,0.3); z-index: 1000; min-width: 400px;';
            // âœ… ØªÙ… Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ø®Ø·Ø£ Ø§Ù„Ù†ØµÙŠ: Ø§Ù„Ù…Ø¯ÙŠØ±
            newUsername.innerHTML = `
                <h3 style="margin-top: 0;">ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¯ÙŠØ± - ${entity.entity_name}</h3>
                <div class="form-group">
                    <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯:</label>
                    <input type="text" id="editUsername" value="${entity.admin_username}">
                </div>
                <div class="form-group">
                    <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©:</label>
                    <input type="password" id="editPassword" value="${entity.admin_password}">
                </div>
                <div style="display: flex; gap: 10px;">
                    <button class="btn btn-success" style="flex: 1;" onclick="saveEntityCredentials('${backendId}')">Ø­ÙØ¸</button>
                    <button class="btn btn-secondary" style="flex: 1;" onclick="this.parentElement.parentElement.remove()">Ø¥Ù„ØºØ§Ø¡</button>
                </div>
            `;
            document.body.appendChild(newUsername);
        }
        
        async function saveEntityCredentials(backendId) {
            const entity = allData.find(item => item.__backendId === backendId);
            if (!entity) return;
            
            const newUsername = document.getElementById('editUsername').value;
            const newPassword = document.getElementById('editPassword').value;
            
            if (!newUsername || !newPassword) {
                showToast('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„', true);
                return;
            }
            
            const updatedEntity = {
                ...entity,
                admin_username: newUsername,
                admin_password: newPassword
            };
            
            const result = await window.dataSdk.update(updatedEntity);
            
            if (result.isOk) {
                // âœ… ØªÙ… Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ø®Ø·Ø£ Ø§Ù„Ù†ØµÙŠ: ØªÙ… ØªØ­Ø¯ÙŠØ«
                showToast('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­');
                document.querySelector('[style*="position: fixed"]').remove();
            } else {
                // âœ… ØªÙ… Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ø®Ø·Ø£ Ø§Ù„Ù†ØµÙŠ: ÙØ´Ù„ ØªØ­Ø¯ÙŠØ«
                showToast('ÙØ´Ù„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', true);
            }
        }

        async function deleteEntity(backendId) {
            const record = allData.find(item => item.__backendId === backendId);
            if (record) {
                const result = await window.dataSdk.delete(record);
                if (result.isOk) {
                    showToast('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¬Ù‡Ø© Ø¨Ù†Ø¬Ø§Ø­');
                } else {
                    showToast('ÙØ´Ù„ Ø­Ø°Ù Ø§Ù„Ø¬Ù‡Ø©', true);
                }
            }
        }

        function showEntityAdminLogin() {
            showPage('entityAdminLoginPage');
        }

        async function loginEntityAdmin(event) {
            event.preventDefault();
            const username = document.getElementById('entityAdminUsername').value;
            const password = document.getElementById('entityAdminPassword').value;
            
            const entity = allData.find(item => item.type === 'entity' && item.id === currentEntityId);
            if (!entity) return;
            
            if ((username === MASTER_USERNAME && password === MASTER_PASSWORD) ||
                (username === entity.admin_username && password === entity.admin_password)) {
                currentUserId = 'admin';
                currentUserRole = 'manager';
                document.getElementById('loggedInUserName').textContent = username;
                document.getElementById('userRole').textContent = 'Ù…Ø¯ÙŠØ±';
                document.getElementById('managerSection').classList.remove('hidden');
                showPage('entityAdminPage');
                renderAdminQuizzes();
                renderMembersList();
                return;
            }
            
            const members = JSON.parse(entity.members || '[]');
            const member = members.find(m => m.username === username && m.password === password);
            
            if (member) {
                currentUserId = member.id;
                currentUserRole = 'member';
                document.getElementById('loggedInUserName').textContent = username;
                document.getElementById('userRole').textContent = 'Ø¹Ø¶Ùˆ';
                document.getElementById('managerSection').classList.add('hidden');
                showPage('entityAdminPage');
                renderAdminQuizzes();
            } else {
                showToast('Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©', true);
            }
        }

        async function addMember() {
            const username = document.getElementById('newMemberUsername').value;
            const password = document.getElementById('newMemberPassword').value;
            
            if (!username || !password) {
                showToast('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„', true);
                return;
            }
            
            const entity = allData.find(item => item.type === 'entity' && item.id === currentEntityId);
            if (!entity) return;
            
            const members = JSON.parse(entity.members || '[]');
            const memberId = 'member_' + Date.now();
            members.push({ id: memberId, username, password });
            
            const updatedEntity = { ...entity, members: JSON.stringify(members) };
            const result = await window.dataSdk.update(updatedEntity);
            
            if (result.isOk) {
                showToast('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ø¶Ùˆ Ø¨Ù†Ø¬Ø§Ø­');
                document.getElementById('newMemberUsername').value = '';
                document.getElementById('newMemberPassword').value = '';
            } else {
                showToast('ÙØ´Ù„ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ø¶Ùˆ', true);
            }
        }

        function renderMembersList() {
            const container = document.getElementById('membersList');
            if (!container) return;
            
            const entity = allData.find(item => item.type === 'entity' && item.id === currentEntityId);
            if (!entity) return;
            
            const members = JSON.parse(entity.members || '[]');
            
            if (members.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£Ø¹Ø¶Ø§Ø¡</p>';
                return;
            }
            
            container.innerHTML = '<h4 style="margin-top: 20px;">Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡:</h4>' + members.map(member => `
                <div class="member-item">
                    <div>
                        <strong>${member.username}</strong>
                    </div>
                    <button class="btn btn-danger" style="width: auto; padding: 8px 20px;" onclick="deleteMember('${member.id}')">Ø­Ø°Ù</button>
                </div>
            `).join('');
        }

        async function deleteMember(memberId) {
            const entity = allData.find(item => item.type === 'entity' && item.id === currentEntityId);
            if (!entity) return;
            
            const members = JSON.parse(entity.members || '[]');
            const updatedMembers = members.filter(m => m.id !== memberId);
            
            const updatedEntity = { ...entity, members: JSON.stringify(updatedMembers) };
            const result = await window.dataSdk.update(updatedEntity);
            
            if (result.isOk) {
                showToast('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¹Ø¶Ùˆ Ø¨Ù†Ø¬Ø§Ø­');
            } else {
                showToast('ÙØ´Ù„ Ø­Ø°Ù Ø§Ù„Ø¹Ø¶Ùˆ', true);
            }
        }

        let questionCounter = 0;
        
        function addQuestionForm() {
            questionCounter++;
            const container = document.getElementById('questionsContainer');
            const questionDiv = document.createElement('div');
            questionDiv.className = 'question-form';
            questionDiv.id = `question_${questionCounter}`;
            
            questionDiv.innerHTML = `
                <div class="question-form-header">
                    <h4>Ø§Ù„Ø³Ø¤Ø§Ù„ ${questionCounter}</h4>
                    <div>
                        <button type="button" class="copy-question-btn" onclick="copyQuestion('question_${questionCounter}')">
                            ğŸ“„ Ù†Ø³Ø® Ø§Ù„Ø³Ø¤Ø§Ù„
                        </button>
                        <button class="remove-question-btn" onclick="removeQuestion('question_${questionCounter}')">Ø­Ø°Ù Ø§Ù„Ø³Ø¤Ø§Ù„</button>
                    </div>
                </div>
                
                <div class="form-group question-type-selector">
                    <label>Ù†ÙˆØ¹ Ø§Ù„Ø³Ø¤Ø§Ù„:</label>
                    <select id="qtype_${questionCounter}" onchange="updateQuestionType('question_${questionCounter}')">
                        <option value="multiple">Ø§Ø®ØªÙŠØ§Ø± Ù…Ù† Ù…ØªØ¹Ø¯Ø¯</option>
                        <option value="truefalse">ØµØ­ Ø£Ùˆ Ø®Ø·Ø£</option>
                        <option value="text">Ø¥Ø¬Ø§Ø¨Ø© Ù†ØµÙŠØ©</option>
                        <option value="checkbox">Ø§Ø®ØªÙŠØ§Ø± Ù…ØªØ¹Ø¯Ø¯ (Ø£ÙƒØ«Ø± Ù…Ù† Ø¥Ø¬Ø§Ø¨Ø©)</option>
                        <option value="matching">Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø©</option>
                        <option value="ordering">Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„ØµØ­ÙŠØ­</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Ù†Øµ Ø§Ù„Ø³Ø¤Ø§Ù„:</label>
                    <input type="text" id="qtext_${questionCounter}" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ø³Ø¤Ø§Ù„ Ù‡Ù†Ø§" required>
                </div>
                
                <div id="answers_${questionCounter}">
                    </div>
            `;
            
            container.appendChild(questionDiv);
            updateQuestionType(`question_${questionCounter}`);
        }
        
        // ğŸ†• Ø¯Ø§Ù„Ø© Ù„Ù†Ø³Ø® Ø³Ø¤Ø§Ù„ Ù…ÙˆØ¬ÙˆØ¯
        function copyQuestion(sourceQuestionId) {
            const sourceDiv = document.getElementById(sourceQuestionId);
            if (!sourceDiv) return;

            // 1. Ø¬Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„Ù…ØµØ¯Ø±
            const qNum = sourceQuestionId.replace('question_', '');
            const qText = document.getElementById(`qtext_${qNum}`).value;
            const qType = document.getElementById(`qtype_${qNum}`).value;
            const questionData = { question: qText, type: qType };

            // Ø§Ø³ØªØ®Ù„Ø§Øµ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹
            if (qType === 'multiple') {
                const answersList = document.getElementById(`answers_list_${qNum}`);
                const answers = [];
                for (let j = 0; j < answersList.children.length; j++) {
                    answers.push(document.getElementById(`ans_${qNum}_${j}`).value);
                }
                const correctRadio = document.querySelector(`input[name="correct_${qNum}"]:checked`);
                questionData.answers = answers;
                questionData.correct = parseInt(correctRadio.value);

            } else if (qType === 'truefalse') {
                const correctRadio = document.querySelector(`input[name="correct_${qNum}"]:checked`);
                questionData.correct = correctRadio.value === 'true';

            } else if (qType === 'text') {
                questionData.correct = document.getElementById(`correct_text_${qNum}`).value;

            } else if (qType === 'checkbox') {
                const answersList = document.getElementById(`answers_list_${qNum}`);
                const answers = [];
                const correct = [];
                for (let j = 0; j < answersList.children.length; j++) {
                    answers.push(document.getElementById(`ans_${qNum}_${j}`).value);
                    const checkbox = answersList.children[j].querySelector(`input[type="checkbox"]`);
                    if (checkbox && checkbox.checked) correct.push(j);
                }
                questionData.answers = answers;
                questionData.correct = correct;

            } else if (qType === 'matching') {
                const matchingList = document.getElementById(`matching_list_${qNum}`);
                const pairs = [];
                for (let j = 0; j < matchingList.children.length; j++) {
                    pairs.push({
                        left: document.getElementById(`match_left_${qNum}_${j}`).value,
                        right: document.getElementById(`match_right_${qNum}_${j}`).value
                    });
                }
                questionData.pairs = pairs;

            } else if (qType === 'ordering') {
                const orderingList = document.getElementById(`ordering_list_${qNum}`);
                const items = [];
                for (let j = 0; j < orderingList.children.length; j++) {
                    items.push(document.getElementById(`order_${qNum}_${j}`).value);
                }
                questionData.correctOrder = items;
            }

            // 2. Ø¥Ø¶Ø§ÙØ© Ø³Ø¤Ø§Ù„ Ø¬Ø¯ÙŠØ¯ ÙˆØªØ¹Ø¨Ø¦ØªÙ‡ Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†Ø³ÙˆØ®Ø©
            questionCounter++;
            const container = document.getElementById('questionsContainer');
            const newQuestionId = `question_${questionCounter}`;
            const newDiv = document.createElement('div');
            newDiv.className = 'question-form';
            newDiv.id = newQuestionId;

            // Ø¨Ù†Ø§Ø¡ Ø§Ù„Ù‡ÙŠÙƒÙ„
            newDiv.innerHTML = `
                <div class="question-form-header">
                    <h4>Ø§Ù„Ø³Ø¤Ø§Ù„ ${questionCounter} (Ù†Ø³Ø®Ø©)</h4>
                    <div>
                        <button type="button" class="copy-question-btn" onclick="copyQuestion('${newQuestionId}')">
                            ğŸ“„ Ù†Ø³Ø® Ø§Ù„Ø³Ø¤Ø§Ù„
                        </button>
                        <button class="remove-question-btn" onclick="removeQuestion('${newQuestionId}')">Ø­Ø°Ù Ø§Ù„Ø³Ø¤Ø§Ù„</button>
                    </div>
                </div>
                
                <div class="form-group question-type-selector">
                    <label>Ù†ÙˆØ¹ Ø§Ù„Ø³Ø¤Ø§Ù„:</label>
                    <select id="qtype_${questionCounter}" onchange="updateQuestionType('${newQuestionId}')">
                        <option value="multiple" ${qType === 'multiple' ? 'selected' : ''}>Ø§Ø®ØªÙŠØ§Ø± Ù…Ù† Ù…ØªØ¹Ø¯Ø¯</option>
                        <option value="truefalse" ${qType === 'truefalse' ? 'selected' : ''}>ØµØ­ Ø£Ùˆ Ø®Ø·Ø£</option>
                        <option value="text" ${qType === 'text' ? 'selected' : ''}>Ø¥Ø¬Ø§Ø¨Ø© Ù†ØµÙŠØ©</option>
                        <option value="checkbox" ${qType === 'checkbox' ? 'selected' : ''}>Ø§Ø®ØªÙŠØ§Ø± Ù…ØªØ¹Ø¯Ø¯ (Ø£ÙƒØ«Ø± Ù…Ù† Ø¥Ø¬Ø§Ø¨Ø©)</option>
                        <option value="matching" ${qType === 'matching' ? 'selected' : ''}>Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø©</option>
                        <option value="ordering" ${qType === 'ordering' ? 'selected' : ''}>Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„ØµØ­ÙŠØ­</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Ù†Øµ Ø§Ù„Ø³Ø¤Ø§Ù„:</label>
                    <input type="text" id="qtext_${questionCounter}" value="${questionData.question}" required>
                </div>
                
                <div id="answers_${questionCounter}"></div>
            `;
            
            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ø¨Ø¹Ø¯ Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„Ù…ØµØ¯Ø±
            sourceDiv.insertAdjacentElement('afterend', newDiv);
            
            // ØªØ¹Ø¨Ø¦Ø© Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„ØªÙØµÙŠÙ„ÙŠØ© ÙÙŠ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø¬Ø¯ÙŠØ¯
            updateQuestionTypeWithData(newQuestionId, questionData);
            
            showToast('ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø³Ø¤Ø§Ù„ Ø¨Ù†Ø¬Ø§Ø­');
        }

        function updateQuestionType(questionId) {
            const qNum = questionId.replace('question_', '');
            const type = document.getElementById(`qtype_${qNum}`).value;
            const answersContainer = document.getElementById(`answers_${qNum}`);
            
            if (type === 'multiple') {
                answersContainer.innerHTML = `
                    <label style="font-weight: bold; display: block; margin-bottom: 10px;">Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª (Ø§Ø®ØªØ± Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©):</label>
                    <div id="answers_list_${qNum}">
                        <div class="answer-input-group">
                            <input type="radio" name="correct_${qNum}" value="0" checked>
                            <input type="text" placeholder="Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© 1" id="ans_${qNum}_0" required>
                        </div>
                        <div class="answer-input-group">
                            <input type="radio" name="correct_${qNum}" value="1">
                            <input type="text" placeholder="Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© 2" id="ans_${qNum}_1" required>
                        </div>
                    </div>
                    <button type="button" class="add-answer-btn" onclick="addAnswerOption('${qNum}')">+ Ø¥Ø¶Ø§ÙØ© Ø¥Ø¬Ø§Ø¨Ø©</button>
                `;
            } else if (type === 'truefalse') {
                answersContainer.innerHTML = `
                    <label style="font-weight: bold; display: block; margin-bottom: 10px;">Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©:</label>
                    <div class="answer-input-group">
                        <input type="radio" name="correct_${qNum}" value="true" checked>
                        <label>ØµØ­</label>
                    </div>
                    <div class="answer-input-group">
                        <input type="radio" name="correct_${qNum}" value="false">
                        <label>Ø®Ø·Ø£</label>
                    </div>
                `;
            } else if (type === 'text') {
                answersContainer.innerHTML = `
                    <div class="form-group">
                        <label>Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©:</label>
                        <input type="text" id="correct_text_${qNum}" placeholder="Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø©" required>
                    </div>
                `;
            } else if (type === 'checkbox') {
                answersContainer.innerHTML = `
                    <label style="font-weight: bold; display: block; margin-bottom: 10px;">Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª (Ø§Ø®ØªØ± Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„ØµØ­ÙŠØ­Ø©):</label>
                    <div id="answers_list_${qNum}">
                        <div class="answer-input-group">
                            <input type="checkbox" class="correct_checkbox_${qNum}" value="0" checked>
                            <input type="text" placeholder="Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© 1" id="ans_${qNum}_0" required>
                        </div>
                        <div class="answer-input-group">
                            <input type="checkbox" class="correct_checkbox_${qNum}" value="1">
                            <input type="text" placeholder="Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© 2" id="ans_${qNum}_1" required>
                        </div>
                    </div>
                    <button type="button" class="add-answer-btn" onclick="addAnswerOptionCheckbox('${qNum}')">+ Ø¥Ø¶Ø§ÙØ© Ø¥Ø¬Ø§Ø¨Ø©</button>
                `;
            } else if (type === 'matching') {
                answersContainer.innerHTML = `
                    <label style="font-weight: bold; display: block; margin-bottom: 10px;">Ø£Ø²ÙˆØ§Ø¬ Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø©:</label>
                    <div id="matching_list_${qNum}">
                        <div class="answer-input-group">
                            <input type="text" placeholder="Ø§Ù„Ø¹Ù†ØµØ± 1" id="match_left_${qNum}_0" required style="flex: 1;">
                            <span style="margin: 0 10px;">âŸ·</span>
                            <input type="text" placeholder="Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚ 1" id="match_right_${qNum}_0" required style="flex: 1;">
                        </div>
                        <div class="answer-input-group">
                            <input type="text" placeholder="Ø§Ù„Ø¹Ù†ØµØ± 2" id="match_left_${qNum}_1" required style="flex: 1;">
                            <span style="margin: 0 10px;">âŸ·</span>
                            <input type="text" placeholder="Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚ 2" id="match_right_${qNum}_1" required style="flex: 1;">
                        </div>
                    </div>
                    <button type="button" class="add-answer-btn" onclick="addMatchingPair('${qNum}')">+ Ø¥Ø¶Ø§ÙØ© Ø²ÙˆØ¬</button>
                `;
            } else if (type === 'ordering') {
                answersContainer.innerHTML = `
                    <label style="font-weight: bold; display: block; margin-bottom: 10px;">Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø¨Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„ØµØ­ÙŠØ­:</label>
                    <div id="ordering_list_${qNum}">
                        <div class="answer-input-group">
                            <span style="font-weight: bold;">1.</span>
                            <input type="text" placeholder="Ø§Ù„Ø¹Ù†ØµØ± Ø§Ù„Ø£ÙˆÙ„" id="order_${qNum}_0" required>
                        </div>
                        <div class="answer-input-group">
                            <span style="font-weight: bold;">2.</span>
                            <input type="text" placeholder="Ø§Ù„Ø¹Ù†ØµØ± Ø§Ù„Ø«Ø§Ù†ÙŠ" id="order_${qNum}_1" required>
                        </div>
                    </div>
                    <button type="button" class="add-answer-btn" onclick="addOrderingItem('${qNum}')">+ Ø¥Ø¶Ø§ÙØ© Ø¹Ù†ØµØ±</button>
                `;
            }
        }
        
        function addAnswerOption(qNum) {
            const list = document.getElementById(`answers_list_${qNum}`);
            const count = list.children.length;
            const div = document.createElement('div');
            div.className = 'answer-input-group';
            // âœ… ØªÙ… Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ø®Ø·Ø£ Ø§Ù„Ù†ØµÙŠ: Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©
            div.innerHTML = `
                <input type="radio" name="correct_${qNum}" value="${count}">
                <input type="text" placeholder="Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© ${count + 1}" id="ans_${qNum}_${count}" required>
                <button type="button" class="remove-answer-btn" onclick="this.parentElement.remove()">Ã—</button>
            `;
            list.appendChild(div);
        }
        
        function addAnswerOptionCheckbox(qNum) {
            const list = document.getElementById(`answers_list_${qNum}`);
            const count = list.children.length;
            const div = document.createElement('div');
            div.className = 'answer-input-group';
            div.innerHTML = `
                <input type="checkbox" class="correct_checkbox_${qNum}" value="${count}">
                <input type="text" placeholder="Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© ${count + 1}" id="ans_${qNum}_${count}" required>
                <button type="button" class="remove-answer-btn" onclick="this.parentElement.remove()">Ã—</button>
            `;
            list.appendChild(div);
        }
        
        function addMatchingPair(qNum) {
            const list = document.getElementById(`matching_list_${qNum}`);
            const count = list.children.length;
            const div = document.createElement('div');
            div.className = 'answer-input-group';
            div.innerHTML = `
                <input type="text" placeholder="Ø§Ù„Ø¹Ù†ØµØ± ${count + 1}" id="match_left_${qNum}_${count}" required style="flex: 1;">
                <span style="margin: 0 10px;">âŸ·</span>
                <input type="text" placeholder="Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚ ${count + 1}" id="match_right_${qNum}_${count}" required style="flex: 1;">
                <button type="button" class="remove-answer-btn" onclick="this.parentElement.remove()">Ã—</button>
            `;
            list.appendChild(div);
        }
        
        function addOrderingItem(qNum) {
            const list = document.getElementById(`ordering_list_${qNum}`);
            const count = list.children.length;
            const div = document.createElement('div');
            div.className = 'answer-input-group';
            // âœ… ØªÙ… Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ø®Ø·Ø£ Ø§Ù„Ù†ØµÙŠ: Ø§Ù„Ø¹Ù†ØµØ±
            div.innerHTML = `
                <span style="font-weight: bold;">${count + 1}.</span>
                <input type="text" placeholder="Ø§Ù„Ø¹Ù†ØµØ± ${count + 1}" id="order_${qNum}_${count}" required>
                <button type="button" class="remove-answer-btn" onclick="this.parentElement.remove()">Ã—</button>
            `;
            list.appendChild(div);
        }
        
        function removeQuestion(questionId) {
            document.getElementById(questionId).remove();
        }
        
        async function saveQuiz() {
            if (allData.length >= 999) {
                // âœ… ØªÙ… Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ø®Ø·Ø£ Ø§Ù„Ù†ØµÙŠ: Ø§Ù„Ø­Ø¯
                showToast('ØªÙ… Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù…Ù† Ø§Ù„Ø³Ø¬Ù„Ø§Øª (999)', true);
                return;
            }

            const title = document.getElementById('quizTitle').value;
            const type = document.getElementById('quizType').value;
            const visibility = document.getElementById('quizVisibility').value;
            
            if (!title) {
                showToast('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©', true);
                return;
            }
            
            const questionsContainer = document.getElementById('questionsContainer');
            if (questionsContainer.children.length === 0) {
                showToast('ÙŠØ±Ø¬Ù‰ Ø¥Ø¶Ø§ÙØ© Ø³Ø¤Ø§Ù„ ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„', true);
                return;
            }
            
            const questions = [];
            for (let i = 0; i < questionsContainer.children.length; i++) {
                const qDiv = questionsContainer.children[i];
                const qNum = qDiv.id.replace('question_', '');
                const qText = document.getElementById(`qtext_${qNum}`).value;
                const qType = document.getElementById(`qtype_${qNum}`).value;
                
                if (!qText) {
                    showToast(`ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù†Øµ Ø§Ù„Ø³Ø¤Ø§Ù„ ${i + 1}`, true);
                    return;
                }
                
                const questionData = { question: qText, type: qType };
                
                if (qType === 'multiple') {
                    const answersList = document.getElementById(`answers_list_${qNum}`);
                    const answers = [];
                    for (let j = 0; j < answersList.children.length; j++) {
                        const ansText = document.getElementById(`ans_${qNum}_${j}`).value;
                        if (!ansText) {
                            showToast(`ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù†Øµ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© ${j + 1} ÙÙŠ Ø§Ù„Ø³Ø¤Ø§Ù„ ${i + 1}`, true);
                            return;
                        }
                        answers.push(ansText);
                    }
                    const correctRadio = document.querySelector(`input[name="correct_${qNum}"]:checked`);
                    questionData.answers = answers;
                    questionData.correct = parseInt(correctRadio.value);
                } else if (qType === 'truefalse') {
                    const correctRadio = document.querySelector(`input[name="correct_${qNum}"]:checked`);
                    questionData.correct = correctRadio.value === 'true';
                } else if (qType === 'text') {
                    const correctText = document.getElementById(`correct_text_${qNum}`).value;
                    if (!correctText) {
                        showToast(`ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø© Ù„Ù„Ø³Ø¤Ø§Ù„ ${i + 1}`, true);
                        return;
                    }
                    questionData.correct = correctText;
                } else if (qType === 'checkbox') {
                    const answersList = document.getElementById(`answers_list_${qNum}`);
                    const answers = [];
                    const correct = [];
                    for (let j = 0; j < answersList.children.length; j++) {
                        const ansText = document.getElementById(`ans_${qNum}_${j}`).value;
                        if (!ansText) {
                            showToast(`ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù†Øµ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© ${j + 1} ÙÙŠ Ø§Ù„Ø³Ø¤Ø§Ù„ ${i + 1}`, true);
                            return;
                        }
                        answers.push(ansText);
                        const checkbox = answersList.children[j].querySelector(`input[type="checkbox"]`);
                        if (checkbox.checked) correct.push(j);
                    }
                    if (correct.length === 0) {
                        showToast(`ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø© ÙˆØ§Ø­Ø¯Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ Ù„Ù„Ø³Ø¤Ø§Ù„ ${i + 1}`, true);
                        return;
                    }
                    questionData.answers = answers;
                    questionData.correct = correct;
                } else if (qType === 'matching') {
                    const matchingList = document.getElementById(`matching_list_${qNum}`);
                    const pairs = [];
                    for (let j = 0; j < matchingList.children.length; j++) {
                        const left = document.getElementById(`match_left_${qNum}_${j}`).value;
                        const right = document.getElementById(`match_right_${qNum}_${j}`).value;
                        if (!left || !right) {
                            showToast(`ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø²ÙˆØ¬ ${j + 1} ÙÙŠ Ø§Ù„Ø³Ø¤Ø§Ù„ ${i + 1}`, true);
                            return;
                        }
                        pairs.push({ left, right });
                    }
                    questionData.pairs = pairs;
                } else if (qType === 'ordering') {
                    const orderingList = document.getElementById(`ordering_list_${qNum}`);
                    const items = [];
                    for (let j = 0; j < orderingList.children.length; j++) {
                        const item = document.getElementById(`order_${qNum}_${j}`).value;
                        if (!item) {
                            showToast(`ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¹Ù†ØµØ± ${j + 1} ÙÙŠ Ø§Ù„Ø³Ø¤Ø§Ù„ ${i + 1}`, true);
                            return;
                        }
                        items.push(item);
                    }
                    questionData.correctOrder = items;
                }
                
                questions.push(questionData);
            }
            
            const quizId = 'quiz_' + Date.now();
            const result = await window.dataSdk.create({
                id: quizId,
                type: 'quiz',
                entity_id: currentEntityId,
                quiz_title: title,
                quiz_type: type,
                visibility: visibility,
                creator_id: currentUserId,
                questions: JSON.stringify(questions)
            });
            
            if (result.isOk) {
                showToast('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© Ø¨Ù†Ø¬Ø§Ø­');
                showMyQuizzes();
            } else {
                showToast('ÙØ´Ù„ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©', true);
            }
        }

        function renderAdminQuizzes() {
            const container = document.getElementById('adminQuizzesList');
            if (!container) return;
            
            let quizzes = allData.filter(item => item.type === 'quiz' && item.entity_id === currentEntityId);
            
            if (currentUserRole === 'member') {
                quizzes = quizzes.filter(q => q.creator_id === currentUserId);
            }
            
            if (quizzes.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø³Ø§Ø¨Ù‚Ø§Øª</p>';
                return;
            }
            
            container.innerHTML = quizzes.map(quiz => {
                const results = allData.filter(item => item.type === 'result' && item.quiz_title === quiz.quiz_title && item.entity_id === currentEntityId);
                const questions = JSON.parse(quiz.questions);
                const totalQuestions = questions.length;
                const participantsCount = results.length;
                const averageScore = participantsCount > 0 ? (results.reduce((sum, r) => sum + r.score, 0) / participantsCount).toFixed(2) : 0;
                const highestScore = participantsCount > 0 ? Math.max(...results.map(r => r.score)).toFixed(2) : 0;
                const lowestScore = participantsCount > 0 ? Math.min(...results.map(r => r.score)).toFixed(2) : 0;
                
                return `
                    <div class="quiz-item">
                        <h4>${quiz.quiz_title}</h4>
                        <div class="quiz-item-meta">
                            <span>Ø§Ù„Ù†ÙˆØ¹: ${quiz.quiz_type === 'quiz' ? 'Ø§Ø®ØªØ¨Ø§Ø±' : 'Ù…Ø³Ø§Ø¨Ù‚Ø©'}</span>
                            <span>Ø§Ù„Ø±Ø¤ÙŠØ©: ${quiz.visibility === 'public' ? 'Ø¹Ø§Ù…' : 'Ø®Ø§Øµ'}</span>
                            <span>Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©: ${totalQuestions}</span>
                        </div>
                        
                        ${participantsCount > 0 ? `
                            <div class="stats-summary">
                                <h5>ğŸ“Š Ù…Ù„Ø®Øµ Ø§Ù„Ù†ØªØ§Ø¦Ø¬:</h5>
                                <div class="stats-grid">
                                    <div><strong>Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ†:</strong> ${participantsCount}</div>
                                    <div><strong>Ø§Ù„Ù…ØªÙˆØ³Ø·:</strong> ${averageScore}/${totalQuestions}</div>
                                    <div><strong>Ø£Ø¹Ù„Ù‰ Ù†ØªÙŠØ¬Ø©:</strong> ${highestScore}/${totalQuestions}</div>
                                    <div><strong>Ø£Ù‚Ù„ Ù†ØªÙŠØ¬Ø©:</strong> ${lowestScore}/${totalQuestions}</div>
                                </div>
                                <button class="btn" style="margin-top: 10px; padding: 8px 20px;" onclick="showQuizParticipants('${quiz.__backendId}')">ğŸ“‹ Ø¹Ø±Ø¶ Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ†</button>
                            </div>
                        ` : '<p style="margin: 10px 0; color: #999; font-style: italic;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ø¨Ø¹Ø¯</p>'}
                        
                        <div style="display: flex; gap: 10px; margin-top: 10px;">
                            <button class="btn" style="width: auto; padding: 8px 20px; flex: 1;" onclick="editQuiz('${quiz.__backendId}')">ØªØ¹Ø¯ÙŠÙ„</button>
                            <button class="btn" style="width: auto; padding: 8px 20px; flex: 1; background: #17a2b8;" onclick="printQuiz('${quiz.__backendId}')">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©</button>
                            
                            <button class="btn btn-secondary" style="width: auto; padding: 8px 20px; flex: 1;" onclick="copyQuiz('${quiz.__backendId}')">
                                ğŸ“‹ Ù†Ø³Ø® Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©
                            </button>
                            
                            <button class="btn btn-danger" style="width: auto; padding: 8px 20px; flex: 1;" onclick="deleteQuiz('${quiz.__backendId}')">Ø­Ø°Ù</button>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        // ğŸ†• Ø¯Ø§Ù„Ø© Ù„Ù†Ø³Ø® Ù…Ø³Ø§Ø¨Ù‚Ø© ÙƒØ§Ù…Ù„Ø©
        async function copyQuiz(backendId) {
            if (allData.length >= 999) {
                showToast('ØªÙ… Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù…Ù† Ø§Ù„Ø³Ø¬Ù„Ø§Øª (999)', true);
                return;
            }
            
            const quiz = allData.find(item => item.__backendId === backendId);
            if (!quiz) {
                showToast('Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©', true);
                return;
            }
            
            const dateStr = new Date().toLocaleDateString('ar-SA');
            const newTitle = `Ù†Ø³Ø®Ø© Ù…Ù† ${quiz.quiz_title} (${dateStr})`;
            
            const newQuiz = {
                ...quiz,
                // Ø­Ø°Ù Ø§Ù„Ù…Ø¹Ø±ÙØ§Øª Ø§Ù„Ø®Ù„ÙÙŠØ© Ù„Ø¶Ù…Ø§Ù† Ø¥Ù†Ø´Ø§Ø¡ Ø³Ø¬Ù„ Ø¬Ø¯ÙŠØ¯
                __backendId: undefined, 
                id: 'quiz_' + Date.now(),
                quiz_title: newTitle,
                // Ù†ØªØ±Ùƒ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© ÙƒÙ…Ø§ Ù‡ÙŠ JSON string
                questions: quiz.questions
                // Ù†ØªØ±Ùƒ creator_id Ùˆ entity_id ÙƒÙ…Ø§ Ù‡Ù…Ø§
            };
            
            const result = await window.dataSdk.create(newQuiz);
            
            if (result.isOk) {
                showToast('ØªÙ… Ù†Ø³Ø® Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© Ø¨Ù†Ø¬Ø§Ø­: ' + newTitle);
            } else {
                showToast('ÙØ´Ù„ Ù†Ø³Ø® Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©', true);
            }
        }


        function editQuiz(backendId) {
            const quiz = allData.find(item => item.__backendId === backendId);
            if (!quiz) return;
            
            document.getElementById('quizTitle').value = quiz.quiz_title;
            document.getElementById('quizType').value = quiz.quiz_type;
            document.getElementById('quizVisibility').value = quiz.visibility;
            
            const questions = JSON.parse(quiz.questions);
            const questionsContainer = document.getElementById('questionsContainer');
            questionsContainer.innerHTML = '';
            questionCounter = 0;
            
            questions.forEach((q, index) => {
                questionCounter++;
                const questionDiv = document.createElement('div');
                questionDiv.className = 'question-form';
                questionDiv.id = `question_${questionCounter}`;
                
                questionDiv.innerHTML = `
                    <div class="question-form-header">
                        <h4>Ø§Ù„Ø³Ø¤Ø§Ù„ ${questionCounter}</h4>
                        <div>
                            <button type="button" class="copy-question-btn" onclick="copyQuestion('question_${questionCounter}')">
                                ğŸ“„ Ù†Ø³Ø® Ø§Ù„Ø³Ø¤Ø§Ù„
                            </button>
                            <button class="remove-question-btn" onclick="removeQuestion('question_${questionCounter}')">Ø­Ø°Ù Ø§Ù„Ø³Ø¤Ø§Ù„</button>
                        </div>
                    </div>
                    
                    <div class="form-group question-type-selector">
                        <label>Ù†ÙˆØ¹ Ø§Ù„Ø³Ø¤Ø§Ù„:</label>
                        <select id="qtype_${questionCounter}" onchange="updateQuestionType('question_${questionCounter}')">
                            <option value="multiple" ${q.type === 'multiple' ? 'selected' : ''}>Ø§Ø®ØªÙŠØ§Ø± Ù…Ù† Ù…ØªØ¹Ø¯Ø¯</option>
                            <option value="truefalse" ${q.type === 'truefalse' ? 'selected' : ''}>ØµØ­ Ø£Ùˆ Ø®Ø·Ø£</option>
                            <option value="text" ${q.type === 'text' ? 'selected' : ''}>Ø¥Ø¬Ø§Ø¨Ø© Ù†ØµÙŠØ©</option>
                            <option value="checkbox" ${q.type === 'checkbox' ? 'selected' : ''}>Ø§Ø®ØªÙŠØ§Ø± Ù…ØªØ¹Ø¯Ø¯ (Ø£ÙƒØ«Ø± Ù…Ù† Ø¥Ø¬Ø§Ø¨Ø©)</option>
                            <option value="matching" ${q.type === 'matching' ? 'selected' : ''}>Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø©</option>
                            <option value="ordering" ${q.type === 'ordering' ? 'selected' : ''}>Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„ØµØ­ÙŠØ­</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Ù†Øµ Ø§Ù„Ø³Ø¤Ø§Ù„:</label>
                        <input type="text" id="qtext_${questionCounter}" value="${q.question}" required>
                    </div>
                    
                    <div id="answers_${questionCounter}"></div>
                `;
                
                questionsContainer.appendChild(questionDiv);
                updateQuestionTypeWithData(`question_${questionCounter}`, q);
            });
            
            document.getElementById('saveQuizBtn').onclick = () => updateQuiz(backendId);
            document.getElementById('saveQuizBtn').textContent = 'ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©';
            showPage('addQuizPage');
        }
        
        function updateQuestionTypeWithData(questionId, questionData) {
            const qNum = questionId.replace('question_', '');
            const type = document.getElementById(`qtype_${qNum}`).value;
            const answersContainer = document.getElementById(`answers_${qNum}`);
            
            if (type === 'multiple') {
                let answersHtml = `<label style="font-weight: bold; display: block; margin-bottom: 10px;">Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª (Ø§Ø®ØªØ± Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©):</label><div id="answers_list_${qNum}">`;
                questionData.answers.forEach((ans, i) => {
                    answersHtml += `
                        <div class="answer-input-group">
                            <input type="radio" name="correct_${qNum}" value="${i}" ${i === questionData.correct ? 'checked' : ''}>
                            <input type="text" value="${ans}" id="ans_${qNum}_${i}" required>
                            ${i > 1 ? '<button type="button" class="remove-answer-btn" onclick="this.parentElement.remove()">Ã—</button>' : ''}
                        </div>`;
                });
                answersHtml += `</div><button type="button" class="add-answer-btn" onclick="addAnswerOption('${qNum}')">+ Ø¥Ø¶Ø§ÙØ© Ø¥Ø¬Ø§Ø¨Ø©</button>`;
                answersContainer.innerHTML = answersHtml;
            } else if (type === 'truefalse') {
                answersContainer.innerHTML = `
                    <label style="font-weight: bold; display: block; margin-bottom: 10px;">Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©:</label>
                    <div class="answer-input-group">
                        <input type="radio" name="correct_${qNum}" value="true" ${questionData.correct === true ? 'checked' : ''}>
                        <label>ØµØ­</label>
                    </div>
                    <div class="answer-input-group">
                        <input type="radio" name="correct_${qNum}" value="false" ${questionData.correct === false ? 'checked' : ''}>
                        <label>Ø®Ø·Ø£</label>
                    </div>
                `;
            } else if (type === 'text') {
                answersContainer.innerHTML = `
                    <div class="form-group">
                        <label>Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©:</label>
                        <input type="text" id="correct_text_${qNum}" value="${questionData.correct}" required>
                    </div>
                `;
            } else if (type === 'checkbox') {
                let answersHtml = `<label style="font-weight: bold; display: block; margin-bottom: 10px;">Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª (Ø§Ø®ØªØ± Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„ØµØ­ÙŠØ­Ø©):</label><div id="answers_list_${qNum}">`;
                questionData.answers.forEach((ans, i) => {
                    answersHtml += `
                        <div class="answer-input-group">
                            <input type="checkbox" class="correct_checkbox_${qNum}" value="${i}" ${questionData.correct.includes(i) ? 'checked' : ''}>
                            <input type="text" value="${ans}" id="ans_${qNum}_${i}" required>
                            ${i > 1 ? '<button type="button" class="remove-answer-btn" onclick="this.parentElement.remove()">Ã—</button>' : ''}
                        </div>`;
                });
                answersHtml += `</div><button type="button" class="add-answer-btn" onclick="addAnswerOptionCheckbox('${qNum}')">+ Ø¥Ø¶Ø§ÙØ© Ø¥Ø¬Ø§Ø¨Ø©</button>`;
                answersContainer.innerHTML = answersHtml;
            } else if (type === 'matching') {
                // âœ… ØªÙ… Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ø®Ø·Ø£ Ø§Ù„Ù†ØµÙŠ: Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø©
                let answersHtml = `<label style="font-weight: bold; display: block; margin-bottom: 10px;">Ø£Ø²ÙˆØ§Ø¬ Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø©:</label><div id="matching_list_${qNum}">`;
                questionData.pairs.forEach((pair, i) => {
                    answersHtml += `
                        <div class="answer-input-group">
                            <input type="text" value="${pair.left}" id="match_left_${qNum}_${i}" required style="flex: 1;">
                            <span style="margin: 0 10px;">âŸ·</span>
                            <input type="text" value="${pair.right}" id="match_right_${qNum}_${i}" required style="flex: 1;">
                            ${i > 1 ? '<button type="button" class="remove-answer-btn" onclick="this.parentElement.remove()">Ã—</button>' : ''}
                        </div>`;
                });
                answersHtml += `</div><button type="button" class="add-answer-btn" onclick="addMatchingPair('${qNum}')">+ Ø¥Ø¶Ø§ÙØ© Ø²ÙˆØ¬</button>`;
                answersContainer.innerHTML = answersHtml;
            } else if (type === 'ordering') {
                // âœ… ØªÙ… Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ø®Ø·Ø£ Ø§Ù„Ù†ØµÙŠ: Ø§Ù„Ø¹Ù†Ø§ØµØ±
                let answersHtml = `<label style="font-weight: bold; display: block; margin-bottom: 10px;">Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø¨Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„ØµØ­ÙŠØ­:</label><div id="ordering_list_${qNum}">`;
                questionData.correctOrder.forEach((item, i) => {
                    answersHtml += `
                        <div class="answer-input-group">
                            <span style="font-weight: bold;">${i + 1}.</span>
                            <input type="text" value="${item}" id="order_${qNum}_${i}" required>
                            ${i > 1 ? '<button type="button" class="remove-answer-btn" onclick="this.parentElement.remove()">Ã—</button>' : ''}
                        </div>`;
                });
                answersHtml += `</div><button type="button" class="add-answer-btn" onclick="addOrderingItem('${qNum}')">+ Ø¥Ø¶Ø§ÙØ© Ø¹Ù†ØµØ±</button>`;
                answersContainer.innerHTML = answersHtml;
            }
        }
        
        async function updateQuiz(backendId) {
            const quiz = allData.find(item => item.__backendId === backendId);
            if (!quiz) return;
            
            const title = document.getElementById('quizTitle').value;
            const type = document.getElementById('quizType').value;
            const visibility = document.getElementById('quizVisibility').value;
            
            if (!title) {
                showToast('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©', true);
                return;
            }
            
            const questionsContainer = document.getElementById('questionsContainer');
            if (questionsContainer.children.length === 0) {
                showToast('ÙŠØ±Ø¬Ù‰ Ø¥Ø¶Ø§ÙØ© Ø³Ø¤Ø§Ù„ ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„', true);
                return;
            }
            
            const questions = [];
            for (let i = 0; i < questionsContainer.children.length; i++) {
                const qDiv = questionsContainer.children[i];
                const qNum = qDiv.id.replace('question_', '');
                const qText = document.getElementById(`qtext_${qNum}`).value;
                const qType = document.getElementById(`qtype_${qNum}`).value;
                
                if (!qText) {
                    showToast(`ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù†Øµ Ø§Ù„Ø³Ø¤Ø§Ù„ ${i + 1}`, true);
                    return;
                }
                
                const questionData = { question: qText, type: qType };
                
                if (qType === 'multiple') {
                    const answersList = document.getElementById(`answers_list_${qNum}`);
                    const answers = [];
                    for (let j = 0; j < answersList.children.length; j++) {
                        const ansText = document.getElementById(`ans_${qNum}_${j}`).value;
                        if (!ansText) {
                            showToast(`ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù†Øµ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© ${j + 1} ÙÙŠ Ø§Ù„Ø³Ø¤Ø§Ù„ ${i + 1}`, true);
                            return;
                        }
                        answers.push(ansText);
                    }
                    const correctRadio = document.querySelector(`input[name="correct_${qNum}"]:checked`);
                    questionData.answers = answers;
                    questionData.correct = parseInt(correctRadio.value);
                } else if (qType === 'truefalse') {
                    const correctRadio = document.querySelector(`input[name="correct_${qNum}"]:checked`);
                    questionData.correct = correctRadio.value === 'true';
                } else if (qType === 'text') {
                    const correctText = document.getElementById(`correct_text_${qNum}`).value;
                    if (!correctText) {
                        showToast(`ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø© Ù„Ù„Ø³Ø¤Ø§Ù„ ${i + 1}`, true);
                        return;
                    }
                    questionData.correct = correctText;
                } else if (qType === 'checkbox') {
                    const answersList = document.getElementById(`answers_list_${qNum}`);
                    const answers = [];
                    const correct = [];
                    for (let j = 0; j < answersList.children.length; j++) {
                        const ansText = document.getElementById(`ans_${qNum}_${j}`).value;
                        if (!ansText) {
                            showToast(`ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù†Øµ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© ${j + 1} ÙÙŠ Ø§Ù„Ø³Ø¤Ø§Ù„ ${i + 1}`, true);
                            return;
                        }
                        answers.push(ansText);
                        const checkbox = answersList.children[j].querySelector(`input[type="checkbox"]`);
                        if (checkbox.checked) correct.push(j);
                    }
                    if (correct.length === 0) {
                        // âœ… ØªÙ… Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ø®Ø·Ø£ Ø§Ù„Ù†ØµÙŠ: Ø§Ù„Ø£Ù‚Ù„
                        showToast(`ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø© ÙˆØ§Ø­Ø¯Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ Ù„Ù„Ø³Ø¤Ø§Ù„ ${i + 1}`, true);
                        return;
                    }
                    questionData.answers = answers;
                    questionData.correct = correct;
                } else if (qType === 'matching') {
                    const matchingList = document.getElementById(`matching_list_${qNum}`);
                    const pairs = [];
                    for (let j = 0; j < matchingList.children.length; j++) {
                        const left = document.getElementById(`match_left_${qNum}_${j}`).value;
                        const right = document.getElementById(`match_right_${qNum}_${j}`).value;
                        if (!left || !right) {
                            showToast(`ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø²ÙˆØ¬ ${j + 1} ÙÙŠ Ø§Ù„Ø³Ø¤Ø§Ù„ ${i + 1}`, true);
                            return;
                        }
                        pairs.push({ left, right });
                    }
                    questionData.pairs = pairs;
                } else if (qType === 'ordering') {
                    const orderingList = document.getElementById(`ordering_list_${qNum}`);
                    const items = [];
                    for (let j = 0; j < orderingList.children.length; j++) {
                        const item = document.getElementById(`order_${qNum}_${j}`).value;
                        if (!item) {
                            showToast(`ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¹Ù†ØµØ± ${j + 1} ÙÙŠ Ø§Ù„Ø³Ø¤Ø§Ù„ ${i + 1}`, true);
                            return;
                        }
                        items.push(item);
                    }
                    questionData.correctOrder = items;
                }
                
                questions.push(questionData);
            }
            
            const updatedQuiz = {
                ...quiz,
                quiz_title: title,
                quiz_type: type,
                visibility: visibility,
                questions: JSON.stringify(questions)
            };
            
            const result = await window.dataSdk.update(updatedQuiz);
            
            if (result.isOk) {
                showToast('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© Ø¨Ù†Ø¬Ø§Ø­');
                document.getElementById('saveQuizBtn').onclick = saveQuiz;
                document.getElementById('saveQuizBtn').textContent = 'Ø­ÙØ¸ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©';
                showMyQuizzes();
            } else {
                showToast('ÙØ´Ù„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©', true);
            }
        }

        async function deleteQuiz(backendId) {
            const record = allData.find(item => item.__backendId === backendId);
            if (record) {
                const result = await window.dataSdk.delete(record);
                if (result.isOk) {
                    // âœ… ØªÙ… Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ø®Ø·Ø£ Ø§Ù„Ù†ØµÙŠ: Ø¨Ù†Ø¬Ø§Ø­
                    showToast('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© Ø¨Ù†Ø¬Ø§Ø­');
                } else {
                    showToast('ÙØ´Ù„ Ø­Ø°Ù Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©', true);
                }
            }
        }

        function printQuiz(backendId) {
            const quiz = allData.find(item => item.__backendId === backendId);
            if (!quiz) return;
            
            const questions = JSON.parse(quiz.questions);
            const entity = allData.find(e => e.type === 'entity' && e.id === quiz.entity_id);
            
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <!DOCTYPE html>
                <html lang="ar" dir="rtl">
                <head>
                    <meta charset="UTF-8">
                    <meta name="viewport" content="width=device-width, initial-scale=1.0">
                    <title>Ø·Ø¨Ø§Ø¹Ø© - ${quiz.quiz_title}</title>
                    <style>
                        @media print {
                            @page {
                                size: A4;
                                margin: 2cm;
                            }
                            .no-print {
                                display: none;
                            }
                        }
                        body {
                            font-family: 'Traditional Arabic', 'Arial', sans-serif;
                            line-height: 1.8;
                            color: #000;
                            background: white;
                            padding: 20px;
                            max-width: 210mm;
                            margin: 0 auto;
                        }
                        .header {
                            text-align: center;
                            border-bottom: 3px double #000;
                            padding-bottom: 20px;
                            margin-bottom: 30px;
                        }
                        .header h1 {
                            font-size: 28px;
                            margin: 10px 0;
                            font-weight: bold;
                        }
                        .header p {
                            font-size: 16px;
                            margin: 5px 0;
                            color: #333;
                        }
                        .info-section {
                            display: flex;
                            justify-content: space-between;
                            margin: 20px 0 30px 0;
                            padding: 15px;
                            border: 2px solid #000;
                            background: #f9f9f9;
                        }
                        .info-item {
                            font-size: 14px;
                        }
                        .info-item strong {
                            font-weight: bold;
                        }
                        .question {
                            margin: 25px 0;
                            padding: 15px;
                            border: 2px solid #333;
                            border-radius: 8px;
                            background: white;
                            page-break-inside: avoid;
                        }
                        .question-header {
                            font-size: 18px;
                            font-weight: bold;
                            margin-bottom: 15px;
                            padding-bottom: 10px;
                            border-bottom: 1px solid #ddd;
                        }
                        .question-text {
                            font-size: 16px;
                            margin-bottom: 15px;
                            line-height: 1.8;
                        }
                        .answers {
                            margin-right: 20px;
                        }
                        .answer-option {
                            display: block;
                            padding: 10px 15px;
                            margin: 8px 0;
                            border: 1px solid #ccc;
                            border-radius: 5px;
                            background: #fafafa;
                            font-size: 15px;
                        }
                        .answer-option::before {
                            content: "â—‹";
                            margin-left: 10px;
                            font-size: 18px;
                        }
                        .answer-space {
                            margin-top: 15px;
                            padding: 15px;
                            border: 1px dashed #999;
                            min-height: 60px;
                            background: #f9f9f9;
                        }
                        .answer-space::before {
                            content: "Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©: ";
                            font-weight: bold;
                            color: #666;
                        }
                        .matching-table {
                            width: 100%;
                            border-collapse: collapse;
                            margin-top: 10px;
                        }
                        .matching-table td {
                            padding: 12px;
                            border: 1px solid #333;
                            font-size: 15px;
                        }
                        .matching-table .left-col {
                            width: 45%;
                            background: #f0f0f0;
                            font-weight: bold;
                        }
                        .matching-table .answer-col {
                            width: 10%;
                            text-align: center;
                            background: white;
                        }
                        .matching-table .right-col {
                            width: 45%;
                            background: #f9f9f9;
                        }
                        .ordering-items {
                            margin-top: 10px;
                        }
                        .ordering-item {
                            padding: 12px;
                            margin: 8px 0;
                            border: 1px solid #999;
                            background: #f5f5f5;
                            border-radius: 5px;
                            font-size: 15px;
                        }
                        .footer {
                            text-align: center;
                            margin-top: 40px;
                            padding-top: 20px;
                            border-top: 2px solid #000;
                            font-size: 14px;
                            color: #666;
                        }
                        .print-button {
                            position: fixed;
                            top: 20px;
                            left: 20px;
                            background: #667eea;
                            color: white;
                            border: none;
                            padding: 15px 30px;
                            border-radius: 8px;
                            font-size: 16px;
                            cursor: pointer;
                            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
                            z-index: 1000;
                        }
                        .print-button:hover {
                            background: #5568d3;
                        }
                    </style>
                </head>
                <body>
                    <button class="print-button no-print" onclick="window.print()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©</button>
                    
                    <div class="header">
                        <h1>${quiz.quiz_title}</h1>
                        <p>${entity ? entity.entity_name : ''}</p>
                        <p>${quiz.quiz_type === 'quiz' ? 'Ø§Ø®ØªØ¨Ø§Ø±' : 'Ù…Ø³Ø§Ø¨Ù‚Ø©'} - ${quiz.visibility === 'public' ? 'Ø¹Ø§Ù…' : 'Ø®Ø§Øµ'}</p>
                    </div>
                    
                    <div class="info-section">
                        <div class="info-item">
                            <strong>Ø§Ù„Ø§Ø³Ù…:</strong> _______________________________
                        </div>
                        <div class="info-item">
                            <strong>Ø§Ù„ØªØ§Ø±ÙŠØ®:</strong> _______________________________
                        </div>
                    </div>
                    
                    <div class="info-section">
                        <div class="info-item">
                            <strong>Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©:</strong> ${questions.length}
                        </div>
                        <div class="info-item">
                            <strong>Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„ÙƒÙ„ÙŠØ©:</strong> ${questions.length}
                        </div>
                        <div class="info-item">
                            <strong>Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„Ù…Ø³ØªØ­Ù‚Ø©:</strong> _______
                        </div>
                    </div>
                    
                    ${generatePrintableQuestions(questions)}
                    
                    <div class="footer">
                        <p>Ø¨Ø§Ù„ØªÙˆÙÙŠÙ‚ ÙˆØ§Ù„Ù†Ø¬Ø§Ø­</p>
                        <p>ØªÙ… Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø¨ÙˆØ§Ø³Ø·Ø© Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø§Øª Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠ</p>
                    </div>
                </body>
                </html>
            `);
            printWindow.document.close();
        }
        
        function generatePrintableQuestions(questions) {
            let html = '';
            
            questions.forEach((q, index) => {
                html += `<div class="question">`;
                html += `<div class="question-header">Ø§Ù„Ø³Ø¤Ø§Ù„ ${index + 1}</div>`;
                html += `<div class="question-text">${q.question}</div>`;
                
                if (q.type === 'multiple') {
                    html += `<div class="answers">`;
                    q.answers.forEach((answer, i) => {
                        html += `<div class="answer-option">${answer}</div>`;
                    });
                    html += `</div>`;
                } else if (q.type === 'truefalse') {
                    html += `<div class="answers">`;
                    html += `<div class="answer-option">ØµØ­</div>`;
                    html += `<div class="answer-option">Ø®Ø·Ø£</div>`;
                    html += `</div>`;
                } else if (q.type === 'text') {
                    html += `<div class="answer-space"></div>`;
                } else if (q.type === 'checkbox') {
                    html += `<div class="answers">`;
                    html += `<p style="margin: 10px 0; font-weight: bold; color: #666;">(Ø§Ø®ØªØ± Ø£ÙƒØ«Ø± Ù…Ù† Ø¥Ø¬Ø§Ø¨Ø©)</p>`;
                    q.answers.forEach((answer, i) => {
                        html += `<div class="answer-option">${answer}</div>`;
                    });
                    html += `</div>`;
                } else if (q.type === 'matching') {
                    html += `<p style="margin: 10px 0; font-weight: bold; color: #666;">ØµÙ„ Ø§Ù„Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø£ÙŠÙ…Ù† Ø¨Ù…Ø§ ÙŠÙ†Ø§Ø³Ø¨Ù‡ Ù…Ù† Ø§Ù„Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø£ÙŠØ³Ø±:</p>`;
                    html += `<table class="matching-table">`;
                    const shuffledRight = [...q.pairs.map(p => p.right)].sort(() => Math.random() - 0.5);
                    q.pairs.forEach((pair, i) => {
                        html += `<tr>`;
                        html += `<td class="left-col">${pair.left}</td>`;
                        html += `<td class="answer-col">( )</td>`;
                        html += `<td class="right-col">${shuffledRight[i]}</td>`;
                        html += `</tr>`;
                    });
                    html += `</table>`;
                } else if (q.type === 'ordering') {
                    html += `<p style="margin: 10px 0; font-weight: bold; color: #666;">Ø±ØªØ¨ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„ØªØ§Ù„ÙŠØ© Ø¨Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„ØµØ­ÙŠØ­:</p>`;
                    html += `<div class="ordering-items">`;
                    const shuffled = [...q.correctOrder].sort(() => Math.random() - 0.5);
                    shuffled.forEach((item, i) => {
                        html += `<div class="ordering-item">( ) ${item}</div>`;
                    });
                    html += `</div>`;
                }
                
                html += `</div>`;
            });
            
            return html;
        }
        
        function showQuizzesSection() {
            document.getElementById('quizzesBackBtn').onclick = goBackToEntity;
            renderQuizzesList();
            showPage('quizzesPage');
        }

        function showPublicQuizzes() {
            document.getElementById('quizzesBackBtn').onclick = goToHome;
            currentEntityId = null;
            renderQuizzesList();
            showPage('quizzesPage');
        }

        function renderQuizzesList() {
            const container = document.getElementById('quizzesList');
            if (!container) return;
            
            let quizzes;
            if (currentEntityId) {
                quizzes = allData.filter(item => item.type === 'quiz' && item.entity_id === currentEntityId);
            } else {
                quizzes = allData.filter(item => item.type === 'quiz' && item.visibility === 'public');
            }
            
            if (quizzes.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø³Ø§Ø¨Ù‚Ø§Øª Ù…ØªØ§Ø­Ø©</p>';
                return;
            }
            
            container.innerHTML = quizzes.map(quiz => {
                const entity = allData.find(e => e.type === 'entity' && e.id === quiz.entity_id);
                return `
                    <div class="quiz-item">
                        <h4>${quiz.quiz_title}</h4>
                        <div class="quiz-item-meta">
                            <span>Ø§Ù„Ù†ÙˆØ¹: ${quiz.quiz_type === 'quiz' ? 'Ø§Ø®ØªØ¨Ø§Ø±' : 'Ù…Ø³Ø§Ø¨Ù‚Ø©'}</span>
                            ${entity ? `<span>Ø§Ù„Ø¬Ù‡Ø©: ${entity.entity_name}</span>` : ''}
                        </div>
                        <button class="btn" style="width: auto; padding: 10px 30px;" onclick="startQuiz('${quiz.id}')">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¢Ù†</button>
                    </div>
                `;
            }).join('');
        }

        let currentQuizData = null;
        let currentQuestionIndex = 0;
        let userAnswers = [];
        let savedAnswers = [];
        
        function startQuiz(quizId) {
            currentQuizId = quizId;
            const quiz = allData.find(item => item.id === quizId);
            if (!quiz) return;
            
            currentQuizData = quiz;
            currentQuestionIndex = 0;
            userAnswers = [];
            savedAnswers = [];
            quizStartTime = null;
            
            showPage('takeQuizPage');
            
            setTimeout(() => {
                const titleElement = document.getElementById('quizTitle');
                const nameInput = document.getElementById('participantName');
                const questionsContainer = document.getElementById('quizQuestionsContainer');
                const startBtn = document.getElementById('startQuizBtn');
                
                if (titleElement) titleElement.textContent = quiz.quiz_title;
                if (nameInput) nameInput.value = '';
                if (questionsContainer) questionsContainer.innerHTML = '';
                
                if (startBtn) {
                    // âœ… ØªÙ… Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ø®Ø·Ø£ Ø§Ù„Ù†ØµÙŠ: Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±
                    startBtn.textContent = quiz.quiz_type === 'competition' ? 'Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©' : 'Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±';
                }
                
                const formGroup = document.querySelector('#takeQuizPage .form-group');
                if (formGroup) {
                    formGroup.style.display = 'block';
                }
                
                const existingNameCard = document.getElementById('participantNameCard');
                if (existingNameCard) {
                    existingNameCard.remove();
                }
            }, 10);
        }

        function startQuizQuestions() {
            const participantName = document.getElementById('participantName').value.trim();
            if (!participantName) {
                showToast('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù…Ùƒ Ø£ÙˆÙ„Ø§Ù‹', true);
                return;
            }
            
            quizStartTime = Date.now();
            currentQuestionIndex = 0;
            userAnswers = [];
            const questions = JSON.parse(currentQuizData.questions);
            savedAnswers = new Array(questions.length).fill(null);
            
            const formGroup = document.querySelector('#takeQuizPage .form-group');
            formGroup.style.display = 'none';
            
            const nameCard = document.createElement('div');
            nameCard.id = 'participantNameCard';
            nameCard.innerHTML = `
                <div style="text-align: center; padding: 25px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 15px; margin-bottom: 25px; box-shadow: 0 5px 15px rgba(0,0,0,0.2);">
                    <p style="margin: 0; font-size: 1.4em; font-weight: bold;">
                        ğŸ‘¤ Ø§Ù„Ù…ØªØ³Ø§Ø¨Ù‚: ${participantName}
                    </p>
                </div>
            `;
            document.getElementById('quizQuestionsContainer').parentElement.insertBefore(nameCard, document.getElementById('quizQuestionsContainer'));
            
            displayCurrentQuestion();
        }
        
        function displayCurrentQuestion() {
            if (!currentQuizData) return;
            
            const questions = JSON.parse(currentQuizData.questions);
            if (currentQuestionIndex >= questions.length) {
                showQuizResults();
                return;
            }
            
            const q = questions[currentQuestionIndex];
            const container = document.getElementById('quizQuestionsContainer');
            const isCompetition = currentQuizData.quiz_type === 'competition';
            
            let answersHtml = '';
            
            if (q.type === 'multiple' || q.type === 'truefalse') {
                const options = q.type === 'truefalse' ? ['ØµØ­', 'Ø®Ø·Ø£'] : q.answers;
                answersHtml = options.map((answer, ansIndex) => `
                    <label class="answer-option" style="cursor: pointer;">
                        <input type="radio" name="current_answer" value="${ansIndex}">
                        ${answer}
                    </label>
                `).join('');
            } else if (q.type === 'text') {
                answersHtml = `
                    <div class="form-group">
                        <input type="text" id="text_answer" placeholder="Ø§ÙƒØªØ¨ Ø¥Ø¬Ø§Ø¨ØªÙƒ Ù‡Ù†Ø§" style="width: 100%;">
                    </div>
                `;
            } else if (q.type === 'checkbox') {
                answersHtml = q.answers.map((answer, ansIndex) => `
                    <label class="answer-option" style="cursor: pointer;">
                        <input type="checkbox" class="checkbox_answer" value="${ansIndex}">
                        ${answer}
                    </label>
                `).join('');
            } else if (q.type === 'matching') {
                const uniqueRight = [...new Set(q.pairs.map(p => p.right))];
                const shuffledRight = [...uniqueRight].sort(() => Math.random() - 0.5);
                answersHtml = `
                    <div style="display: grid; gap: 15px;">
                        ${q.pairs.map((pair, i) => `
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <span style="flex: 1; padding: 10px; background: #f8f9fa; border-radius: 5px;">${pair.left}</span>
                                <span style="margin: 0 10px;">âŸ·</span>
                                <select class="matching_answer" data-index="${i}" style="flex: 1; padding: 10px; border: 2px solid #e0e0e0; border-radius: 5px;">
                                    <option value="">-- Ø§Ø®ØªØ± --</option>
                                    ${shuffledRight.map((right, j) => `<option value="${right}">${right}</option>`).join('')}
                                </select>
                            </div>
                        `).join('')}
                    </div>
                `;
            } else if (q.type === 'ordering') {
                const shuffled = [...q.correctOrder].sort(() => Math.random() - 0.5);
                answersHtml = `
                    <p style="margin-bottom: 10px; font-weight: bold;">Ø±ØªØ¨ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø¨Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„ØµØ­ÙŠØ­:</p>
                    <div id="ordering_container" style="display: grid; gap: 10px;">
                        ${shuffled.map((item, i) => `
                            <div class="ordering_item" draggable="true" data-item="${item}" 
                                 style="padding: 15px; background: #f8f9fa; border-radius: 5px; cursor: move; border: 2px solid #e0e0e0;">
                                ${item}
                            </div>
                        `).join('')}
                    </div>
                `;
            }
            
            const navigationHtml = isCompetition ? '' : `
                <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 10px;">
                    ${questions.map((_, i) => `
                        <button onclick="navigateToQuestion(${i})" 
                                style="width: 45px; height: 45px; border-radius: 8px; border: 2px solid ${i === currentQuestionIndex ? '#667eea' : '#e0e0e0'}; 
                                background: ${savedAnswers[i] !== null ? '#d4edda' : (i === currentQuestionIndex ? '#667eea' : 'white')}; 
                                color: ${i === currentQuestionIndex ? 'white' : '#333'}; font-weight: bold; cursor: pointer; transition: all 0.3s;">
                            ${i + 1}
                        </button>
                    `).join('')}
                </div>
            `;
            
            container.innerHTML = `
                ${navigationHtml}
                <div style="margin-bottom: 20px; padding: 15px; background: #f0f0f0; border-radius: 10px; text-align: center;">
                    <strong>Ø§Ù„Ø³Ø¤Ø§Ù„ ${currentQuestionIndex + 1} Ù…Ù† ${questions.length}</strong>
                </div>
                <div class="question-item">
                    <h4>${q.question}</h4>
                    ${answersHtml}
                    <div id="feedback_area" style="margin-top: 15px;"></div>
                    <button class="btn btn-success" style="margin-top: 20px;" onclick="${isCompetition ? 'submitCompetitionAnswer()' : 'submitQuizAnswer()'}">
                        ${isCompetition ? (currentQuestionIndex < questions.length - 1 ? 'ØªØ³Ù„ÙŠÙ… ÙˆØ¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©' : 'ØªØ³Ù„ÙŠÙ… Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©') : (currentQuestionIndex < questions.length - 1 ? 'Ø­ÙØ¸ ÙˆØ§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„ØªØ§Ù„ÙŠ' : 'Ø­ÙØ¸ ÙˆØ¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±')}
                    </button>
                </div>
            `;
            
            if (q.type === 'ordering') {
                setupDragAndDrop();
            }
            
            restoreSavedAnswer();
        }
        
        function restoreSavedAnswer() {
            const questions = JSON.parse(currentQuizData.questions);
            const q = questions[currentQuestionIndex];
            const savedAnswer = savedAnswers[currentQuestionIndex];
            
            if (savedAnswer === null) return;
            
            if (q.type === 'multiple' || q.type === 'truefalse') {
                const radio = document.querySelector(`input[name="current_answer"][value="${savedAnswer}"]`);
                if (radio) radio.checked = true;
            } else if (q.type === 'text') {
                const textInput = document.getElementById('text_answer');
                if (textInput) textInput.value = savedAnswer;
            } else if (q.type === 'checkbox') {
                savedAnswer.forEach(val => {
                    const checkbox = document.querySelector(`.checkbox_answer[value="${val}"]`);
                    if (checkbox) checkbox.checked = true;
                });
            } else if (q.type === 'matching') {
                const selects = document.querySelectorAll('.matching_answer');
                savedAnswer.forEach((val, i) => {
                    if (selects[i]) selects[i].value = val;
                });
            } else if (q.type === 'ordering') {
                const container = document.getElementById('ordering_container');
                container.innerHTML = '';
                savedAnswer.forEach(item => {
                    const div = document.createElement('div');
                    div.className = 'ordering_item';
                    div.draggable = true;
                    div.dataset.item = item;
                    div.style.cssText = 'padding: 15px; background: #f8f9fa; border-radius: 5px; cursor: move; border: 2px solid #e0e0e0;';
                    div.textContent = item;
                    container.appendChild(div);
                });
                setupDragAndDrop();
            }
        }
        
        function navigateToQuestion(index) {
            saveCurrentAnswer();
            currentQuestionIndex = index;
            displayCurrentQuestion();
        }
        
        function saveCurrentAnswer() {
            const questions = JSON.parse(currentQuizData.questions);
            const q = questions[currentQuestionIndex];
            
            let answer = null;
            
            if (q.type === 'multiple' || q.type === 'truefalse') {
                const selected = document.querySelector('input[name="current_answer"]:checked');
                if (selected) {
                    answer = q.type === 'truefalse' ? (selected.value === '0') : parseInt(selected.value);
                }
            } else if (q.type === 'text') {
                const textInput = document.getElementById('text_answer');
                if (textInput && textInput.value.trim()) {
                    answer = textInput.value.trim();
                }
            } else if (q.type === 'checkbox') {
                const checked = document.querySelectorAll('.checkbox_answer:checked');
                if (checked.length > 0) {
                    answer = Array.from(checked).map(c => parseInt(c.value));
                }
            } else if (q.type === 'matching') {
                const selects = document.querySelectorAll('.matching_answer');
                const allAnswers = Array.from(selects).map(s => s.value);
                if (allAnswers.every(a => a !== '')) {
                    answer = allAnswers;
                }
            } else if (q.type === 'ordering') {
                const items = document.querySelectorAll('.ordering_item');
                if (items.length > 0) {
                    answer = Array.from(items).map(item => item.dataset.item);
                }
            }
            
            savedAnswers[currentQuestionIndex] = answer;
        }
        
        function setupDragAndDrop() {
            const items = document.querySelectorAll('.ordering_item');
            let draggedItem = null;
            
            items.forEach(item => {
                item.addEventListener('dragstart', function() {
                    draggedItem = this;
                    setTimeout(() => this.style.opacity = '0.5', 0);
                });
                
                item.addEventListener('dragend', function() {
                    setTimeout(() => this.style.opacity = '1', 0);
                });
                
                item.addEventListener('dragover', function(e) {
                    e.preventDefault();
                });
                
                item.addEventListener('drop', function(e) {
                    e.preventDefault();
                    if (this !== draggedItem) {
                        const container = document.getElementById('ordering_container');
                        const allItems = [...container.children];
                        const draggedIndex = allItems.indexOf(draggedItem);
                        const targetIndex = allItems.indexOf(this);
                        
                        if (draggedIndex < targetIndex) {
                            this.parentNode.insertBefore(draggedItem, this.nextSibling);
                        } else {
                            this.parentNode.insertBefore(draggedItem, this);
                        }
                    }
                });
            });
        }
        
        function submitQuizAnswer() {
            saveCurrentAnswer();
            
            const savedAnswer = savedAnswers[currentQuestionIndex];
            if (savedAnswer === null) {
                showToast('ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø³Ø¤Ø§Ù„', true);
                return;
            }
            
            const questions = JSON.parse(currentQuizData.questions);
            
            if (currentQuestionIndex < questions.length - 1) {
                currentQuestionIndex++;
                displayCurrentQuestion();
            } else {
                for (let i = 0; i < questions.length; i++) {
                    if (savedAnswers[i] === null) {
                        showToast(`ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø³Ø¤Ø§Ù„ ${i + 1}`, true);
                        currentQuestionIndex = i;
                        displayCurrentQuestion();
                        return;
                    }
                }
                
                userAnswers = questions.map((q, i) => ({
                    question: q.question,
                    type: q.type,
                    userAnswer: savedAnswers[i],
                    correctAnswer: q.correct || q.correctOrder || q.pairs
                }));
                
                showQuizResults();
            }
        }
        
        function submitCompetitionAnswer() {
            const questions = JSON.parse(currentQuizData.questions);
            const q = questions[currentQuestionIndex];
            
            let userAnswer = null;
            let isCorrect = false;
            let partialScore = 0;
            
            if (q.type === 'multiple' || q.type === 'truefalse') {
                const selected = document.querySelector('input[name="current_answer"]:checked');
                if (!selected) {
                    showToast('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø¥Ø¬Ø§Ø¨Ø©', true);
                    return;
                }
                userAnswer = q.type === 'truefalse' ? (selected.value === '0') : parseInt(selected.value);
                isCorrect = userAnswer === q.correct || (q.type === 'truefalse' && userAnswer === q.correct);
                partialScore = isCorrect ? 1 : 0;
                
                // ğŸ†• Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ Ù‡Ù†Ø§: Ø§Ø­ØªÙØ§Ù„ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø© Ù„Ù„Ø§Ø®ØªÙŠØ§Ø± Ù…Ù† Ù…ØªØ¹Ø¯Ø¯ ÙˆØµØ­/Ø®Ø·Ø£
                if (isCorrect) {
                    const celebrations = [
                        { emoji: 'ğŸ‰', message: 'Ù…Ù…ØªØ§Ø²! Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø©!' },
                        { emoji: 'ğŸŒŸ', message: 'Ø±Ø§Ø¦Ø¹ Ø¬Ø¯Ø§Ù‹! Ø£Ø­Ø³Ù†Øª!' },
                        { emoji: 'ğŸ†', message: 'Ù…Ø°Ù‡Ù„! Ø¥Ø¬Ø§Ø¨Ø© Ù…Ø«Ø§Ù„ÙŠØ©!' }
                    ];
                    const celebration = celebrations[Math.floor(Math.random() * celebrations.length)];
                    showCelebration('success', celebration.message, celebration.emoji);
                } else {
                    showCelebration('wrong', 'Ø¥Ø¬Ø§Ø¨Ø© Ø®Ø§Ø·Ø¦Ø©. Ø±Ø§Ø¬Ø¹ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø© Ø£Ø¯Ù†Ø§Ù‡.', 'âŒ');
                }
                
            } else if (q.type === 'text') {
                userAnswer = document.getElementById('text_answer').value.trim();
                if (!userAnswer) {
                    showToast('ÙŠØ±Ø¬Ù‰ ÙƒØªØ§Ø¨Ø© Ø¥Ø¬Ø§Ø¨Ø©', true);
                    return;
                }
                // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ´Ø§Ø¨Ù‡ Ù„ØªØ­Ø¯ÙŠØ¯ Ù…Ø§ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø© Ø£Ùˆ Ù‚Ø±ÙŠØ¨Ø©
                const normalizedUserAnswer = normalizeArabicText(userAnswer);
                const normalizedCorrectAnswer = normalizeArabicText(q.correct);
                isCorrect = normalizedUserAnswer === normalizedCorrectAnswer;
                
                const similarity = calculateSimilarity(normalizedUserAnswer, normalizedCorrectAnswer);
                
                if (isCorrect) {
                    partialScore = 1;
                    const celebrations = [
                        { emoji: 'ğŸ‰', message: 'Ù…Ù…ØªØ§Ø²! Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø©!' },
                        { emoji: 'ğŸŒŸ', message: 'Ø±Ø§Ø¦Ø¹ Ø¬Ø¯Ø§Ù‹! Ø£Ø­Ø³Ù†Øª!' },
                        { emoji: 'ğŸ†', message: 'Ù…Ø°Ù‡Ù„! Ø¥Ø¬Ø§Ø¨Ø© Ù…Ø«Ø§Ù„ÙŠØ©!' }
                    ];
                    const celebration = celebrations[Math.floor(Math.random() * celebrations.length)];
                    showCelebration('success', celebration.message, celebration.emoji);
                } else if (similarity > 0.7) {
                    partialScore = 0.5; // ÙŠÙ…Ù†Ø­ Ù†Ù‚Ø·Ø© Ø¬Ø²Ø¦ÙŠØ© Ù„Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„Ù‚Ø±ÙŠØ¨Ø© Ø¬Ø¯Ù‹Ø§
                    showCelebration('close', 'Ù„Ù‚Ø¯ Ø§Ù‚ØªØ±Ø¨Øª Ù…Ù† Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©!', 'ğŸ˜Š');
                } else {
                    partialScore = 0;
                    showCelebration('wrong', 'Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰. Ø±Ø§Ø¬Ø¹ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø© Ø£Ø¯Ù†Ø§Ù‡.', 'ğŸ’ª');
                }
                
            } else if (q.type === 'checkbox') {
                const checked = document.querySelectorAll('.checkbox_answer:checked');
                if (checked.length === 0) {
                    showToast('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø¥Ø¬Ø§Ø¨Ø© ÙˆØ§Ø­Ø¯Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„', true);
                    return;
                }
                userAnswer = Array.from(checked).map(c => parseInt(c.value)).sort();
                const correctAnswers = q.correct.sort();
                const totalCorrect = correctAnswers.length;
                const correctSelected = userAnswer.filter(ans => correctAnswers.includes(ans)).length;
                const wrongSelected = userAnswer.filter(ans => !correctAnswers.includes(ans)).length;
                
                // Ø§Ù„ØªØ­Ø¯ÙŠØ«: Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„ØµØ­ÙŠØ­Ø© = Ø§Ù„Ø®Ø§Ø·Ø¦Ø© Ù„Ø§ Ù†Ø®ØµÙ…
                if (correctSelected === wrongSelected && userAnswer.length === totalCorrect) {
                    partialScore = 0;
                } else {
                    partialScore = Math.max(0, (correctSelected - wrongSelected) / totalCorrect);
                }
                
                isCorrect = JSON.stringify(userAnswer) === JSON.stringify(correctAnswers);
                
                if (isCorrect) {
                    const celebrations = [
                        { emoji: 'ğŸ‰', message: 'Ù…Ù…ØªØ§Ø²! Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø©!' },
                        { emoji: 'âœ¨', message: 'Ø¹Ø¸ÙŠÙ…! ÙˆØ§ØµÙ„ Ø§Ù„ØªÙ…ÙŠØ²!' },
                    ];
                    const celebration = celebrations[Math.floor(Math.random() * celebrations.length)];
                    showCelebration('success', celebration.message, celebration.emoji);
                } else if (partialScore > 0.5) {
                    showCelebration('close', 'Ø¥Ø¬Ø§Ø¨Ø© Ø¬ÙŠØ¯Ø©! Ù‚Ø±ÙŠØ¨Ø© Ù…Ù† Ø§Ù„ØµØ­ÙŠØ­Ø©.', 'ğŸ‘');
                } else {
                    showCelebration('wrong', 'Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰. Ø±Ø§Ø¬Ø¹ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø© Ø£Ø¯Ù†Ø§Ù‡.', 'ğŸ’ª');
                }
                
            } else if (q.type === 'matching') {
                const selects = document.querySelectorAll('.matching_answer');
                userAnswer = [];
                for (let select of selects) {
                    if (!select.value) {
                        showToast('ÙŠØ±Ø¬Ù‰ Ø¥ÙƒÙ…Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø§Øª', true);
                        return;
                    }
                    userAnswer.push(select.value);
                }
                const correctMatches = userAnswer.filter((ans, i) => ans === q.pairs[i].right).length;
                partialScore = correctMatches / q.pairs.length;
                isCorrect = userAnswer.every((ans, i) => ans === q.pairs[i].right);
                
                if (isCorrect) {
                    showCelebration('success', 'Ø¹Ù…Ù„ Ø±Ø§Ø¦Ø¹ ÙÙŠ Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø©!', 'ğŸ¥³');
                } else if (partialScore > 0.5) {
                    showCelebration('close', 'Ø£Ø­Ø³Ù†Øª! Ø¬Ø²Ø¡ ÙƒØ¨ÙŠØ± Ù…Ù† Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­.', 'ğŸ™‚');
                } else {
                    showCelebration('wrong', 'Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰. Ø±Ø§Ø¬Ø¹ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø© Ø£Ø¯Ù†Ø§Ù‡.', 'ğŸ’ª');
                }
                
            } else if (q.type === 'ordering') {
                const items = document.querySelectorAll('.ordering_item');
                userAnswer = Array.from(items).map(item => item.dataset.item);
                let correctPositions = 0;
                userAnswer.forEach((item, i) => {
                    if (item === q.correctOrder[i]) correctPositions++;
                });
                partialScore = correctPositions / q.correctOrder.length;
                isCorrect = JSON.stringify(userAnswer) === JSON.stringify(q.correctOrder);
                
                if (isCorrect) {
                    showCelebration('success', 'Ø§Ù„ØªØ±ØªÙŠØ¨ Ù…Ø«Ø§Ù„ÙŠ!', 'ğŸ‘');
                } else if (partialScore > 0.5) {
                    showCelebration('close', 'Ø§Ù‚ØªØ±Ø¨Øª Ù…Ù† Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„ØµØ­ÙŠØ­.', 'ğŸ¤”');
                } else {
                    showCelebration('wrong', 'Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰. Ø±Ø§Ø¬Ø¹ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø© Ø£Ø¯Ù†Ø§Ù‡.', 'ğŸ’ª');
                }
            }
            
            const feedbackArea = document.getElementById('feedback_area');
            if (isCorrect) {
                feedbackArea.innerHTML = '<div style="padding: 15px; background: #d4edda; color: #155724; border-radius: 8px; font-weight: bold;">âœ“ Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø©!</div>';
            } else if (partialScore > 0) {
                // Ø¹Ø±Ø¶ Ø§Ù„ØªÙ…ÙŠÙŠØ² Ø§Ù„ÙÙˆØ±ÙŠ Ù„Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø´Ø¨Ù‡ Ø§Ù„ØµØ­ÙŠØ­Ø©
                let correctAnswerText = '';
                if (q.type === 'multiple') {
                     correctAnswerText = `Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ÙŠØ©: ${q.answers[q.correct]}`;
                } else if (q.type === 'truefalse') {
                    correctAnswerText = `Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ÙŠØ©: ${q.correct ? 'ØµØ­' : 'Ø®Ø·Ø£'}`;
                } else if (q.type === 'text') {
                    correctAnswerText = `Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ÙŠØ©: ${q.correct}`;
                } else if (q.type === 'checkbox') {
                    correctAnswerText = `Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ÙŠØ©: ${q.correct.map(i => q.answers[i]).join(' ØŒ ')}`;
                } else if (q.type === 'matching') {
                    correctAnswerText = 'Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø§Øª Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ÙŠØ©: ' + q.pairs.map(p => `${p.left} âŸ· ${p.right}`).join(' | ');
                } else if (q.type === 'ordering') {
                    correctAnswerText = `Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ÙŠ: ${q.correctOrder.join(' â† ')}`;
                }
                feedbackArea.innerHTML = `<div style="padding: 15px; background: #fff3cd; color: #856404; border-radius: 8px;">â— Ø¥Ø¬Ø§Ø¨Ø© Ø¬Ø²Ø¦ÙŠØ© ØµØ­ÙŠØ­Ø© (${(partialScore * 100).toFixed(0)}%)<br><strong>${correctAnswerText}</strong></div>`;
            } else {
                let correctAnswerText = '';
                if (q.type === 'multiple') {
                    correctAnswerText = `Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ÙŠØ©: ${q.answers[q.correct]}`;
                } else if (q.type === 'truefalse') {
                    correctAnswerText = `Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ÙŠØ©: ${q.correct ? 'ØµØ­' : 'Ø®Ø·Ø£'}`;
                } else if (q.type === 'text') {
                    correctAnswerText = `Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ÙŠØ©: ${q.correct}`;
                } else if (q.type === 'checkbox') {
                    correctAnswerText = `Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ÙŠØ©: ${q.correct.map(i => q.answers[i]).join(' ØŒ ')}`;
                } else if (q.type === 'matching') {
                    correctAnswerText = 'Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø§Øª Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ÙŠØ©: ' + q.pairs.map(p => `${p.left} âŸ· ${p.right}`).join(' | ');
                } else if (q.type === 'ordering') {
                    correctAnswerText = `Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ÙŠ: ${q.correctOrder.join(' â† ')}`;
                }
                feedbackArea.innerHTML = `<div style="padding: 15px; background: #f8d7da; color: #721c24; border-radius: 8px;">âœ— Ø¥Ø¬Ø§Ø¨Ø© Ø®Ø§Ø·Ø¦Ø©<br><strong>${correctAnswerText}</strong></div>`;
            }
            
            userAnswers.push({
                question: q.question,
                type: q.type,
                userAnswer: userAnswer,
                correctAnswer: q.correct || q.correctOrder || q.pairs,
                isCorrect: isCorrect,
                partialScore: partialScore
            });
            
            document.querySelectorAll('input, select').forEach(el => {
                el.disabled = true;
            });
            
            const btn = document.querySelector('.question-item button');
            btn.disabled = false;
            btn.classList.remove('btn-success');
            btn.classList.add('btn');
            btn.textContent = currentQuestionIndex < questions.length - 1 ? 'Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„ØªØ§Ù„ÙŠ' : 'Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©';
            btn.onclick = () => {
                currentQuestionIndex++;
                displayCurrentQuestion();
            };
        }
        
        async function showQuizResults() {
            if (allData.length >= 999) {
                showToast('ØªÙ… Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù…Ù† Ø§Ù„Ø³Ø¬Ù„Ø§Øª (999)', true);
                return;
            }

            const participantName = document.getElementById('participantName').value;
            const questions = JSON.parse(currentQuizData.questions);
            const isCompetition = currentQuizData.quiz_type === 'competition';
            
            let score = 0;
            if (isCompetition) {
                score = userAnswers.reduce((sum, a) => sum + (a.partialScore || 0), 0);
            } else {
                userAnswers.forEach((answer, index) => {
                    const q = questions[index];
                    if (q.type === 'multiple' || q.type === 'truefalse') {
                        if (answer.userAnswer === q.correct) score++;
                    } else if (q.type === 'text') {
                        const normalizedUserAnswer = normalizeArabicText(answer.userAnswer);
                        const normalizedCorrectAnswer = normalizeArabicText(q.correct);
                        if (normalizedUserAnswer === normalizedCorrectAnswer) score++;
                    } else if (q.type === 'checkbox') {
                        const correctAnswers = q.correct;
                        const userAnswersArr = answer.userAnswer;
                        const totalCorrect = correctAnswers.length;
                        const correctSelected = userAnswersArr.filter(ans => correctAnswers.includes(ans)).length;
                        const wrongSelected = userAnswersArr.filter(ans => !correctAnswers.includes(ans)).length;
                        
                        // Ø§Ù„ØªØ­Ø¯ÙŠØ«: Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„ØµØ­ÙŠØ­Ø© = Ø§Ù„Ø®Ø§Ø·Ø¦Ø© Ù„Ø§ Ù†Ø®ØµÙ…
                        if (correctSelected === wrongSelected && userAnswersArr.length === totalCorrect) {
                            score += 0;
                        } else {
                            const partialScore = Math.max(0, (correctSelected - wrongSelected) / totalCorrect);
                            score += partialScore;
                        }
                    } else if (q.type === 'matching') {
                        const correctMatches = answer.userAnswer.filter((ans, i) => ans === q.pairs[i].right).length;
                        score += correctMatches / q.pairs.length;
                    } else if (q.type === 'ordering') {
                        let correctPositions = 0;
                        answer.userAnswer.forEach((item, i) => {
                            if (item === q.correctOrder[i]) correctPositions++;
                        });
                        score += correctPositions / q.correctOrder.length;
                    }
                });
            }
            
            const timeTaken = Math.floor((Date.now() - quizStartTime) / 1000);
            
            const result = await window.dataSdk.create({
                id: 'result_' + Date.now(),
                type: 'result',
                entity_id: currentQuizData.entity_id,
                quiz_title: currentQuizData.quiz_title,
                participant_name: participantName,
                score: score,
                time_taken: timeTaken,
                completed_at: Date.now(),
                user_answers: JSON.stringify(userAnswers)
            });
            
            if (result.isOk) {
                displayResultsSummary(score, questions.length);
            } else {
                showToast('ÙØ´Ù„ Ø­ÙØ¸ Ø§Ù„Ù†ØªÙŠØ¬Ø©', true);
            }
        }
        
        function displayResultsSummary(score, total) {
            const questions = JSON.parse(currentQuizData.questions);
            const container = document.getElementById('quizQuestionsContainer');
            
            const isCompetition = currentQuizData.quiz_type === 'competition';
            let summaryHtml = `
                <div style="text-align: center; padding: 30px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 15px; margin-bottom: 30px;">
                    <h2 style="margin: 0 0 10px 0; font-size: 2.5em;">ğŸ‰ ${isCompetition ? 'Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©' : 'Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±'}!</h2>
                    <p style="font-size: 2em; margin: 0; font-weight: bold;">Ø§Ù„Ù†ØªÙŠØ¬Ø©: ${score.toFixed(2)} Ù…Ù† ${total}</p>
                    <p style="font-size: 1.2em; margin: 10px 0 0 0;">${isCompetition ? 'Ù†Ø³Ø¨Ø© Ø§Ù„ØªØ­ØµÙŠÙ„' : 'Ù†Ø³Ø¨Ø© Ø§Ù„Ù†Ø¬Ø§Ø­'}: ${Math.round((score / total) * 100)}%</p>
                </div>
                
                <h3 style="margin-bottom: 20px;">Ù…Ù„Ø®Øµ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„ØªÙØµÙŠÙ„ÙŠ:</h3>
            `;
            
            userAnswers.forEach((answer, index) => {
                const q = questions[index];
                let isCorrect = false;
                let correctAnswerText = '';
                let userAnswerText = '';
                let partialScore = '';
                
                if (q.type === 'multiple') {
                    isCorrect = answer.userAnswer === q.correct;
                    userAnswerText = q.answers[answer.userAnswer];
                    correctAnswerText = q.answers[q.correct];
                } else if (q.type === 'truefalse') {
                    isCorrect = answer.userAnswer === q.correct;
                    userAnswerText = answer.userAnswer ? 'ØµØ­' : 'Ø®Ø·Ø£';
                    correctAnswerText = q.correct ? 'ØµØ­' : 'Ø®Ø·Ø£';
                } else if (q.type === 'text') {
                    const normalizedUserAnswer = normalizeArabicText(answer.userAnswer);
                    const normalizedCorrectAnswer = normalizeArabicText(q.correct);
                    
                    if (isCompetition) {
                        isCorrect = answer.isCorrect;
                    } else {
                        isCorrect = normalizedUserAnswer === normalizedCorrectAnswer;
                    }
                    
                    userAnswerText = answer.userAnswer;
                    correctAnswerText = q.correct;
                } else if (q.type === 'checkbox') {
                    const correctAnswers = q.correct;
                    const userAnswersArr = answer.userAnswer;
                    const totalCorrect = correctAnswers.length;
                    const correctSelected = userAnswersArr.filter(ans => correctAnswers.includes(ans)).length;
                    const wrongSelected = userAnswersArr.filter(ans => !correctAnswers.includes(ans)).length;
                    const missed = correctAnswers.filter(ans => !userAnswersArr.includes(ans)).length;
                    
                    if (isCompetition) {
                        isCorrect = answer.isCorrect;
                    } else {
                        isCorrect = JSON.stringify(userAnswersArr.sort()) === JSON.stringify(correctAnswers.sort());
                    }
                    
                    userAnswerText = userAnswersArr.map(i => q.answers[i]).join(' ØŒ ');
                    correctAnswerText = correctAnswers.map(i => q.answers[i]).join(' ØŒ ');
                    
                    // Ø§Ù„ØªØ­Ø¯ÙŠØ«: Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„ØµØ­ÙŠØ­Ø© = Ø§Ù„Ø®Ø§Ø·Ø¦Ø© Ù„Ø§ Ù†Ø®ØµÙ…
                    let partial = 0;
                    if (correctSelected === wrongSelected && userAnswersArr.length === totalCorrect) {
                        partial = 0;
                    } else {
                        partial = Math.max(0, (correctSelected - wrongSelected) / totalCorrect);
                    }
                    
                    partialScore = `<p style="margin: 5px 0; color: #666;"><strong>Ø§Ù„ØªÙ‚ÙŠÙŠÙ…:</strong> ${correctSelected} ØµØ­ÙŠØ­Ø©ØŒ ${wrongSelected} Ø®Ø§Ø·Ø¦Ø©ØŒ ${missed} Ù…ÙÙ‚ÙˆØ¯Ø© | Ø§Ù„Ù†Ù‚Ø§Ø·: ${partial.toFixed(2)}/1</p>`;
                } else if (q.type === 'matching') {
                    const correctMatches = answer.userAnswer.filter((ans, i) => ans === q.pairs[i].right).length;
                    isCorrect = answer.userAnswer.every((ans, i) => ans === q.pairs[i].right);
                    userAnswerText = q.pairs.map((p, i) => `${p.left} âŸ· ${answer.userAnswer[i]}`).join(' | ');
                    correctAnswerText = q.pairs.map(p => `${p.left} âŸ· ${p.right}`).join(' | ');
                    const partial = correctMatches / q.pairs.length;
                    partialScore = `<p style="margin: 5px 0; color: #666;"><strong>Ø§Ù„ØªÙ‚ÙŠÙŠÙ…:</strong> ${correctMatches} Ù…Ù† ${q.pairs.length} Ù…Ø·Ø§Ø¨Ù‚Ø§Øª ØµØ­ÙŠØ­Ø© | Ø§Ù„Ù†Ù‚Ø§Ø·: ${partial.toFixed(2)}/1</p>`;
                } else if (q.type === 'ordering') {
                    let correctPositions = 0;
                    answer.userAnswer.forEach((item, i) => {
                        if (item === q.correctOrder[i]) correctPositions++;
                    });
                    isCorrect = JSON.stringify(answer.userAnswer) === JSON.stringify(q.correctOrder);
                    userAnswerText = answer.userAnswer.join(' â† ');
                    correctAnswerText = q.correctOrder.join(' â† ');
                    const partial = correctPositions / q.correctOrder.length;
                    partialScore = `<p style="margin: 5px 0; color: #666;"><strong>Ø§Ù„ØªÙ‚ÙŠÙŠÙ…:</strong> ${correctPositions} Ù…Ù† ${q.correctOrder.length} ÙÙŠ Ø§Ù„Ù…ÙˆØ¶Ø¹ Ø§Ù„ØµØ­ÙŠØ­ | Ø§Ù„Ù†Ù‚Ø§Ø·: ${partial.toFixed(2)}/1</p>`;
                }
                
                const bgColor = isCorrect ? '#d4edda' : (partialScore && !isCorrect ? '#fff3cd' : '#f8d7da');
                const borderColor = isCorrect ? '#28a745' : (partialScore && !isCorrect ? '#ffc107' : '#dc3545');
                const icon = isCorrect ? 'âœ“' : (partialScore && !isCorrect ? 'â—' : 'âœ—');
                
                summaryHtml += `
                    <div style="padding: 20px; background: ${bgColor}; border-radius: 10px; margin-bottom: 15px; border-right: 5px solid ${borderColor};">
                        <h4 style="margin: 0 0 10px 0;">${icon} Ø§Ù„Ø³Ø¤Ø§Ù„ ${index + 1}: ${q.question}</h4>
                        <p style="margin: 5px 0;"><strong>Ø¥Ø¬Ø§Ø¨ØªÙƒ:</strong> ${userAnswerText}</p>
                        ${partialScore}
                        ${!isCorrect ? `<p style="margin: 5px 0; color: #155724;"><strong>Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ÙŠØ©:</strong> ${correctAnswerText}</p>` : ''}
                    </div>
                `;
            });
            
            summaryHtml += `
                <button class="btn" style="margin-top: 20px;" onclick="goBackToQuizzes()">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù…Ø³Ø§Ø¨Ù‚Ø§Øª</button>
            `;
            
            container.innerHTML = summaryHtml;
        }

        function goBackToQuizzes() {
            if (currentEntityId) {
                showQuizzesSection();
            } else {
                showPublicQuizzes();
            }
        }

        function showLeaderboardSection() {
            document.getElementById('leaderboardBackBtn').onclick = goBackToEntity;
            renderLeaderboard();
            showPage('leaderboardPage');
        }

        function showPublicLeaderboard() {
            document.getElementById('leaderboardBackBtn').onclick = goToHome;
            currentEntityId = null;
            renderLeaderboard();
            showPage('leaderboardPage');
        }

        function renderLeaderboard() {
            const tbody = document.getElementById('leaderboardBody');
            if (!tbody) return;
            
            let results;
            if (currentEntityId) {
                results = allData.filter(item => item.type === 'result' && item.entity_id === currentEntityId);
            } else {
                results = allData.filter(item => item.type === 'result');
            }
            
            results.sort((a, b) => {
                if (b.score !== a.score) return b.score - a.score;
                return a.time_taken - b.time_taken;
            });
            
            if (results.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align: center; color: #666;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬</td></tr>';
                return;
            }
            
            tbody.innerHTML = results.map((result, index) => `
                <tr>
                    <td>${index + 1}</td>
                    <td>${result.participant_name}</td>
                    <td>${result.quiz_title}</td>
                    <td>${result.score.toFixed(2)}</td>
                    <td>${result.time_taken}</td>
                </tr>
            `).join('');
        }
        
        // ğŸ†• ÙˆØ¸ÙŠÙØ© Ø¹Ø±Ø¶ Ø¹Ø¬Ù„Ø© Ø§Ù„Ø­Ø¸ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
        function showWheelOfFortune() {
             showPage('wheelPage');
             // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ø¹Ø¬Ù„Ø© Ù…Ø±Ø³ÙˆÙ…Ø© ÙˆÙ…Ø¹Ø§Ù„Ø¬Ø© Ø£Ø²Ø±Ø§Ø±Ù‡Ø§
             parseNames(); 
        }

        // ----------------------------------------------------------------------
        // ğŸ†• Ø¯ÙˆØ§Ù„ Ø¹Ø¬Ù„Ø© Ø§Ù„Ø­Ø¸ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© (Ù…Ù† Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø°ÙŠ Ø£Ø±Ø³Ù„ØªÙ‡)
        // ----------------------------------------------------------------------

        let names = [];
        let isSpinning = false;
        let currentRotation = 0;
        let currentWinner = null;
        let canvas = null;
        let ctx = null;
        const wheelColors = ['#81c784', '#64b5f6', '#ffb74d', '#e57373', '#ba68c8', '#4db6ac', '#ff8a65', '#9575cd'];
        
        function initWheel() {
            canvas = document.getElementById('wheelCanvas');
            // ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ø¹Ù†ØµØ± Ù‚Ø¨Ù„ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø³ÙŠØ§Ù‚
            if (canvas) {
                ctx = canvas.getContext('2d');
                
                // Ø¥Ø¶Ø§ÙØ© Ù…Ø¹Ø§Ù„Ø¬Ø§Øª Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ù„ØµÙØ­Ø© Ø¹Ø¬Ù„Ø© Ø§Ù„Ø­Ø¸
                const namesTextarea = document.getElementById('namesTextarea');
                const spinButton = document.getElementById('spinButton');
                const closeModal = document.getElementById('closeModal');
                const deleteWinnerBtn = document.getElementById('deleteWinner');
                
                if (namesTextarea) namesTextarea.addEventListener('input', parseNames);
                if (spinButton) spinButton.addEventListener('click', spinWheel);
                
                // ğŸ†• ØªØµØ­ÙŠØ­ Ù…Ø´ÙƒÙ„Ø© Ø§Ù„Ø¥ØºÙ„Ø§Ù‚: Ù†Ù‚ÙˆÙ… Ø¨Ø±Ø¨Ø· Ø¯ÙˆØ§Ù„ Ø§Ù„Ø¥ØºÙ„Ø§Ù‚ Ù…Ø¨Ø§Ø´Ø±Ø© Ø¨Ø§Ù„Ù€ onclick
                if (closeModal) closeModal.onclick = () => {
                    document.getElementById('winnerModal').classList.remove('show');
                };
                if (deleteWinnerBtn) deleteWinnerBtn.onclick = () => {
                    if (currentWinner) {
                        const textarea = document.getElementById('namesTextarea');
                        // ÙŠØ¬Ø¨ Ø¥Ø¹Ø§Ø¯Ø© Ø¬Ù„Ø¨ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ù‚Ø¨Ù„ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ù„Ø¶Ù…Ø§Ù† Ø§Ù„ØªØ­Ø¯ÙŠØ«
                        const currentNames = textarea.value.split('\n').filter(n => n.trim());
                        // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ÙØ§Ø¦Ø² (Ù‚Ø¯ ÙŠÙƒÙˆÙ† Ù‡Ù†Ø§Ùƒ Ø£Ø³Ù…Ø§Ø¡ Ù…ÙƒØ±Ø±Ø©ØŒ Ù„Ø°Ø§ Ù†Ø²ÙŠÙ„ Ø£ÙˆÙ„ ØªØ·Ø§Ø¨Ù‚)
                        const indexToRemove = currentNames.findIndex(n => n.trim() === currentWinner.trim());
                        
                        if (indexToRemove !== -1) {
                            currentNames.splice(indexToRemove, 1);
                        }
                        
                        textarea.value = currentNames.join('\n');
                        parseNames();
                        currentWinner = null;
                        showToast('ØªÙ… Ø­Ø°Ù Ø§Ù„ÙØ§Ø¦Ø² Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©.');
                    }
                    document.getElementById('winnerModal').classList.remove('show');
                };

                // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ ÙˆØ±Ø³Ù… Ø§Ù„Ø¹Ø¬Ù„Ø© Ø¹Ù†Ø¯ Ø§Ù„ØªÙ‡ÙŠØ¦Ø©
                parseNames(); 
            }
        }
        
        function parseNames() {
            const textarea = document.getElementById('namesTextarea');
            if (!textarea) return; // ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ textarea
            
            const text = textarea.value.trim();
            
            if (!text) {
                names = [];
            } else {
                names = text.split('\n')
                    .map(name => name.trim())
                    .filter(name => name.length > 0);
            }
            
            drawWheel();
            updateSpinButton();
        }

        function drawWheel() {
            if (!ctx || !canvas) return;

            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            if (names.length === 0) {
                ctx.fillStyle = '#f0f0f0';
                ctx.beginPath();
                ctx.arc(200, 200, 192, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.fillStyle = '#999';
                ctx.font = '18px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('Ø£Ø¯Ø®Ù„ Ø£Ø³Ù…Ø§Ø¡ Ù„Ù„Ø¨Ø¯Ø¡', 200, 200);
                return;
            }

            const anglePerSegment = (Math.PI * 2) / names.length;
            // ÙŠØªÙ… ØªØ¹ÙˆÙŠØ¶ Ø²Ø§ÙˆÙŠØ© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© Ø¨Ù€ -Math.PI / 2 Ù„ØªÙˆØ¬Ù‡ Ø§Ù„Ø³Ù‡Ù… Ù„Ø£Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø±ÙƒØ²
            const startOffset = -Math.PI / 2;
            
            names.forEach((name, index) => {
                const startAngle = startOffset + (anglePerSegment * index);
                const endAngle = startAngle + anglePerSegment;
                
                ctx.fillStyle = wheelColors[index % wheelColors.length];
                ctx.beginPath();
                ctx.arc(200, 200, 192, startAngle, endAngle);
                ctx.lineTo(200, 200);
                ctx.fill();
                
                ctx.save();
                ctx.translate(200, 200);
                ctx.rotate(startAngle + anglePerSegment / 2);
                ctx.textAlign = 'right';
                ctx.fillStyle = '#ffffff';
                ctx.font = 'bold 18px Arial';
                ctx.shadowColor = 'rgba(0,0,0,0.3)';
                ctx.shadowBlur = 3;
                ctx.fillText(name.length > 12 ? name.substring(0, 12) + '...' : name, 170, 10);
                ctx.restore();
            });
        }

        function updateSpinButton() {
            const spinButton = document.getElementById('spinButton');
            if (spinButton) {
                spinButton.disabled = names.length < 2 || isSpinning;
            }
        }

        function spinWheel() {
            if (isSpinning || names.length < 2) return;
            
            isSpinning = true;
            const spinButton = document.getElementById('spinButton');
            spinButton.classList.add('spinning');
            updateSpinButton();

            // 1. ØªØ«Ø¨ÙŠØª Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠ: Ù†Ø²ÙŠÙ„ Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„
            canvas.style.transition = 'none';
            // Ù†Ø¹ÙŠØ¯ ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø¯ÙˆØ±Ø§Ù† Ù„Ø¶Ù…Ø§Ù† Ø£Ù† Ø§Ù„Ù…ØªØµÙØ­ 'ÙŠØ¹Ø±Ù' Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ø¯ÙˆÙ† Ø§Ù†ØªÙ‚Ø§Ù„ Ù…Ø±Ø¦ÙŠ
            currentRotation = currentRotation % 360; 
            canvas.style.transform = `rotate(${currentRotation}deg)`;
            
            // 2. Ø¥Ø¬Ø¨Ø§Ø± Ø§Ù„Ù…ØªØµÙØ­ Ø¹Ù„Ù‰ Ø¥Ø¹Ø§Ø¯Ø© ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØ®Ø·ÙŠØ· (Reflow)
            // Ù‡Ø°Ù‡ Ø§Ù„Ø®Ø·ÙˆØ© Ø­Ø§Ø³Ù…Ø© Ù„Ø¶Ù…Ø§Ù† Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªØ±Ø§Ù†Ø²ÙŠØ´Ù† Ø§Ù„Ù‚Ø¯ÙŠÙ… Ù‚Ø¨Ù„ ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¬Ø¯ÙŠØ¯
            void canvas.offsetWidth;
            
            // 3. ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¯ÙˆØ±Ø§Ù† Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù…Ø¹ Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø§Ù„Ø³Ù„Ø³
            const spins = 5 + Math.random() * 3;
            const extraDegrees = Math.random() * 360;
            const totalRotation = spins * 360 + extraDegrees;
            
            canvas.style.transition = 'transform 4s cubic-bezier(0.17, 0.67, 0.12, 0.99)';
            canvas.style.transform = `rotate(${currentRotation + totalRotation}deg)`;
            
            currentRotation += totalRotation;

            setTimeout(() => {
                // 1. Ø­Ø³Ø§Ø¨ Ø§Ù„ÙØ§Ø¦Ø²
                const finalRotation = currentRotation % 360;
                const anglePerSegment = 360 / names.length;
                
                // 360 - finalRotation: ÙŠØªÙ… Ø­Ø³Ø§Ø¨Ù‡Ø§ Ø¨Ø§Ù„Ù†Ø³Ø¨Ø© Ù„Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ø³Ù‡Ù… (Ø§Ù„Ø£Ø¹Ù„Ù‰)
                let normalizedAngle = (360 - finalRotation) % 360; 
                if (normalizedAngle < 0) normalizedAngle += 360;

                const winnerIndex = Math.floor(normalizedAngle / anglePerSegment) % names.length;
                const winner = names[winnerIndex];

                // 2. Ø¹Ø±Ø¶ Ø§Ù„ÙØ§Ø¦Ø² ÙˆØ¥Ø·Ù„Ø§Ù‚ Ø§Ù„ÙƒÙˆÙ†ÙÙŠØªÙŠ
                showWinner(winner);
                createConfetti();

                // 3. Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø­Ø§Ù„Ø© Ø§Ù„Ø¯ÙˆØ±Ø§Ù†
                isSpinning = false;
                spinButton.classList.remove('spinning');
                updateSpinButton();
                
                // 4. Ø­ÙØ¸ Ø§Ù„ÙØ§Ø¦Ø² ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Ù…Ù†Ø·Ù‚ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø£ØµÙ„ÙŠ)
                saveWinnerToDb(winner); 
            }, 4000);
        }

        function showWinner(winner) {
            const modal = document.getElementById('winnerModal');
            const winnerName = document.getElementById('winnerName');
            
            currentWinner = winner;
            winnerName.textContent = winner;
            modal.classList.add('show');
            
            // ğŸ†• ØªÙ… Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ù…Ø¹Ø§Ù„Ø¬Ø§Øª Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ù…Ø±Ø¨ÙˆØ·Ø© ÙÙŠ Ø¯Ø§Ù„Ø© initWheel Ù„Ù…Ù†Ø¹ Ø§Ù„ØªÙƒØ±Ø§Ø±
        }

        async function saveWinnerToDb(winner) {
             if (allData.length >= 999) {
                showToast('ØªÙ… Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù…Ù† Ø§Ù„Ø³Ø¬Ù„Ø§ØªØŒ Ù„Ù… ÙŠØªÙ… Ø­ÙØ¸ Ø§Ù„ÙØ§Ø¦Ø² ÙÙŠ Ø§Ù„Ø³Ø¬Ù„Ø§Øª.', true);
                return;
            }
            
            const result = await window.dataSdk.create({
                id: 'winner_' + Date.now(),
                type: 'winner',
                winner_name: winner,
                won_at: Date.now()
            });
            
            if (!result.isOk) {
                console.error("Failed to save winner to database.");
            }
        }
        
        function createConfetti() {
            const colors = ['#81c784', '#64b5f6', '#ffb74d', '#e57373', '#ba68c8', '#4db6ac'];
            const confettiCount = 150;

            for (let i = 0; i < confettiCount; i++) {
                // Ø§Ø³ØªØ®Ø¯Ø§Ù… setTimeout Ù„Ø¥Ù†Ø´Ø§Ø¡ ØªØ£Ø«ÙŠØ± ØªØ¯Ø±ÙŠØ¬ÙŠ (Ù…Ø«Ù„Ù…Ø§ ÙƒØ§Ù† ÙÙŠ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø£ØµÙ„ÙŠ)
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti-piece'; // Ù†Ø³ØªØ®Ø¯Ù… Ù‡Ø°Ø§ Ø§Ù„Ø§Ø³Ù… Ù„Ø£Ù†Ù‡ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ CSS Ø§Ù„Ø­Ø±ÙƒØ©
                    confetti.style.left = Math.random() * 100 + '%';
                    confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.animationDelay = Math.random() * 0.5 + 's';
                    confetti.style.animationDuration = (Math.random() * 2 + 2) + 's';
                    confetti.style.width = (Math.random() * 10 + 5) + 'px';
                    confetti.style.height = confetti.style.width;
                    document.body.appendChild(confetti);

                    setTimeout(() => confetti.remove(), 3000);
                }, i * 20);
            }
        }
        
        // Ø¯Ø§Ù„Ø© ØªØ·Ø¨ÙŠØ¹ Ø§Ù„Ù†Øµ Ø§Ù„Ø¹Ø±Ø¨ÙŠ Ù„Ø¥Ø²Ø§Ù„Ø© Ø¹Ù„Ø§Ù…Ø§Øª Ø§Ù„ØªØ´ÙƒÙŠÙ„ ÙˆØªÙˆØ­ÙŠØ¯ Ø§Ù„Ù‡Ù…Ø²Ø§Øª ÙˆØ§Ù„ØªØ§Ø¡ Ø§Ù„Ù…Ø±Ø¨ÙˆØ·Ø©
        function normalizeArabicText(text) {
            if (!text) return '';
            return text
                .replace(/Ø£|Ø¥|Ø¢/g, 'Ø§') // ØªÙˆØ­ÙŠØ¯ Ø§Ù„Ù‡Ù…Ø²Ø§Øª
                .replace(/Ø©/g, 'Øª')    // ØªÙˆØ­ÙŠØ¯ Ø§Ù„ØªØ§Ø¡ Ø§Ù„Ù…Ø±Ø¨ÙˆØ·Ø©
                .replace(/[Ù‘Ù€Ù-Ù’]/g, '') // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªØ´ÙƒÙŠÙ„
                .toLowerCase().trim();
        }

        // Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ Ø§Ù„Ø§Ø­ØªÙØ§Ù„
        function showCelebration(type, message, emoji) {
            const overlay = document.getElementById('celebration-overlay');
            const emojiEl = document.getElementById('celebration-emoji');
            const messageEl = document.getElementById('celebration-message');
            const closeBtn = document.getElementById('celebration-close');
            
            emojiEl.textContent = emoji;
            messageEl.textContent = message;
            
            // ØªØ­Ø¯ÙŠØ¯ Ù„ÙˆÙ† Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ù†ÙˆØ¹ Ø§Ù„Ø§Ø­ØªÙØ§Ù„
            messageEl.style.color = type === 'success' ? '#28a745' : type === 'close' ? '#ffc107' : '#dc3545';
            
            // ØªØ­Ø¯ÙŠØ¯ Ù„ÙˆÙ† Ø²Ø± Ø§Ù„Ø¥ØºÙ„Ø§Ù‚ Ù„ÙŠØªÙ†Ø§Ø³Ø¨ Ù…Ø¹ Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ø¹Ø§Ù…Ø© (ÙŠÙ…ÙƒÙ† ØªØ¹Ø¯ÙŠÙ„Ù‡)
            closeBtn.style.background = defaultConfig.primary_color || '#667eea'; 
            
            overlay.style.display = 'flex';
            
            if (type === 'success') {
                createConfetti();
            }
            
            // Ø¥Ø²Ø§Ù„Ø© Ø·Ø¨Ù‚Ø© Ø§Ù„ØªØ±Ø§ÙƒØ¨ Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©
            closeBtn.onclick = () => {
                overlay.style.display = 'none';
            };
        }
        
        // Ø¯Ø§Ù„Ø© Ø­Ø³Ø§Ø¨ Ø§Ù„ØªØ´Ø§Ø¨Ù‡ Ø¨ÙŠÙ† Ø§Ù„Ù†ØµÙˆØµ (Ù…Ø³Ø§ÙØ© Ù„ÙŠÙÙ†Ø´ØªØ§ÙŠÙ†)
        function calculateSimilarity(str1, str2) {
            const longer = str1.length > str2.length ? str1 : str2;
            const shorter = str1.length > str2.length ? str2 : str1;
            
            if (longer.length === 0) return 1.0;
            
            const editDistance = getEditDistance(longer, shorter);
            return (longer.length - editDistance) / longer.length;
        }
        
        // Ø¯Ø§Ù„Ø© Ø­Ø³Ø§Ø¨ Ù…Ø³Ø§ÙØ© Ø§Ù„ØªØ­Ø±ÙŠØ± (Edit Distance)
        function getEditDistance(str1, str2) {
            const costs = [];
            for (let i = 0; i <= str1.length; i++) {
                let lastValue = i;
                for (let j = 0; j <= str2.length; j++) {
                    if (i === 0) {
                        costs[j] = j;
                    } else if (j > 0) {
                        let newValue = costs[j - 1];
                        if (str1.charAt(i - 1) !== str2.charAt(j - 1)) {
                            newValue = Math.min(Math.min(newValue, lastValue), costs[j]) + 1;
                        }
                        costs[j - 1] = lastValue;
                        lastValue = newValue;
                    }
                }
                if (i > 0) costs[str2.length] = lastValue;
            }
            return costs[str2.length];
        }
        
        // ----------------------------------------------------------------------
        // Ù†Ù‡Ø§ÙŠØ© Ø¯ÙˆØ§Ù„ Ø§Ù„Ø§Ø­ØªÙØ§Ù„ ÙˆØ§Ù„ØªØ´Ø§Ø¨Ù‡
        // ----------------------------------------------------------------------

        document.addEventListener('DOMContentLoaded', initApp);
    </script>
 </body>
</html>